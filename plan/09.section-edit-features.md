# 区域编辑模式 - 完整功能点清单

> 本文档基于 `plan/08.section-edit-mode.md` 梳理，列出所有需要实现的功能点
> 用于开发跟踪和进度管理

---

## 一、进入与退出

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 1.1 | 双击区域进入编辑模式 | ⬜ | |
| 1.3 | 工具栏"进入编辑"按钮 | ⬜ | 选中区域时显示 |
| 1.4 | Enter 快捷键进入 | ⬜ | 需选中单个区域 |
| 1.5 | 进入前检查（单选） | ⬜ | 多选时提示"请只选择一个区域" |
| 1.6 | 进入前检查（多边形有效） | ⬜ | points.length >= 3 |
| 1.7 | 点击返回按钮退出 | ⬜ | |
| 1.9 | 保存后退出 | ⬜ | 保存座位+校准数据 |

---

## 二、校准模式

### 2.1 校准画布

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 2.1.1 | 显示完整底图 SVG 背景 | ⬜ | opacity: 0.7 |
| 2.1.2 | 区域内部底图高亮显示 | ⬜ | clipPath 裁剪, opacity: 0.8 |
| 2.1.3 | 区域外部半透明遮罩 | ⬜ | mask 实现, opacity: 0.5 |
| 2.1.4 | 显示区域边框（虚线） | ⬜ | strokeDasharray |
| 2.1.10 | 画布缩放 50% - 1000% | ⬜ | 滑块+滚轮控制 |
| 2.1.11 | 画布平移（空格+拖拽） | ⬜ | |
| 2.1.13 | 自动居中定位区域 | ⬜ | ResizeObserver |
| 2.1.14 | 修复缩放"飘"问题 | ⬜ | 参照主画布 transform matrix |

### 2.2 校准面板

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 2.2.1 | 画布缩放滑块（50%-1000%） | ⬜ | |
| 2.2.6 | 预览矩阵切换按钮 | ⬜ | 2×2, 3×3, 4×4, 5×5, 实际 |
| 2.2.7 | 预计容量计算显示 | ⬜ | 根据参数计算 |
| 2.2.8 | 重置按钮 | ⬜ | R键快捷键 |


---

## 三、编辑模式界面

### 3.1 顶部面板（PanelTop）

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 3.1.1 | 返回按钮 | ⬜ | 带返回图标 |
| 3.1.2 | 区域名称显示 | ⬜ | 格式："区域 A - 座位编辑" |
| 3.1.3 | 保存按钮 | ⬜ | 保存座位数据 |
| 3.1.4 | 帮助按钮 | ⬜ | 显示快捷键说明 |
| 3.1.5 | PanelTop mode="section-edit" 支持 | ⬜ | 需要修改组件 |

### 3.2 左侧面板（PanelLeft）

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 3.2.1 | 选择工具（V） | ⬜ | |
| 3.2.2 | 单排座位工具（1） | ⬜ | |
| 3.2.3 | 矩阵座位工具（2） | ⬜ | |
| 3.2.4 | 弧线排列工具（3） | ⬜ | |
| 3.2.5 | 工具激活状态显示 | ⬜ | |
| 3.2.6 | PanelLeft mode="section-edit" 支持 | ⬜ | 需要修改组件 |
| 3.2.7 | 工具快捷键提示 | ⬜ | 标签显示 (V), (1), (2), (3) |

### 3.3 右侧面板（PanelRight）

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 3.3.1 | 座位属性区域 | ⬜ | |
| 3.3.2 | 行号输入框 | ⬜ | |
| 3.3.3 | 座位号输入框 | ⬜ | |
| 3.3.4 | 座位类型下拉 | ⬜ | 正常/VIP/无障碍/空位 |
| 3.3.5 | 座位角度输入 | ⬜ | 0-360° |
| 3.3.8 | 选中座位信息展示 | ⬜ | 未选中时显示提示 |
| 3.3.9 | PanelRight mode="section-edit" 支持 | ⬜ | 需要修改组件 |

### 3.4 悬浮控件（FloatingControls）

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 3.4.1 | 摇杆控制（上/下/左/右） | ⬜ | |
| 3.4.2 | 缩放控制（+/-） | ⬜ | |
| 3.4.3 | 重置中心按钮 | ⬜ | |
| 3.4.4 | 状态栏显示 | ⬜ | 坐标/排数/座位数 |

---

## 四、座位绘制功能

### 4.1 绘制工具

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 4.1.1 | 单排座位放置 | ⬜ | 点击画布放置 |
| 4.1.2 | 矩阵拖拽绘制 | ⬜ | 拖拽确定行列 |
| 4.1.3 | 矩阵行数计算 | ⬜ | 根据拖拽距离 |
| 4.1.4 | 矩阵列数计算 | ⬜ | 根据拖拽距离 |
| 4.1.5 | 弧线排列绘制 | ⬜ | 后续版本实现 |
| 4.1.6 | 使用校准默认间距 | ⬜ | 矩阵绘制时 |
| 4.1.7 | 实时预览矩阵范围 | ⬜ | 拖拽时显示虚线框 |

### 4.2 座位选择

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 4.2.1 | 单击选择单个座位 | ⬜ | |
| 4.2.2 | 框选多个座位 | ⬜ | |
| 4.2.3 | Ctrl+单击多选 | ⬜ | |
| 4.2.4 | 选择框实时显示 | ⬜ | |
| 4.2.5 | 选中座位高亮 | ⬜ | 边框或背景色变化 |

### 4.3 座位编辑

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 4.3.1 | 拖拽移动座位 | ⬜ | 实时预览 |
| 4.3.2 | 批量移动座位 | ⬜ | 多选时 |
| 4.3.3 | Delete 删除座位 | ⬜ | |
| 4.3.4 | 批量删除座位 | ⬜ | 多选时 |
| 4.3.5 | 修改行号 | ⬜ | 右侧面板 |
| 4.3.6 | 修改座位号 | ⬜ | 右侧面板 |
| 4.3.7 | 修改座位类型 | ⬜ | 右侧面板 |
| 4.3.8 | 修改座位角度 | ⬜ | 右侧面板 |
| 4.3.9 | 自动重排行号 | ⬜ | 移动后可选 |

### 4.4 座位数据

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 4.4.1 | 座位唯一ID | ⬜ | |
| 4.4.2 | 局部坐标存储 | ⬜ | localX, localY |
| 4.4.3 | 世界坐标转换 | ⬜ | 保存时转换 |
| 4.4.4 | 行号存储 | ⬜ | row: string |
| 4.4.5 | 座位号存储 | ⬜ | number: number |
| 4.4.6 | 角度存储 | ⬜ | angle: number |
| 4.4.7 | 类型存储 | ⬜ | type: enum |
| 4.4.8 | 视觉尺寸比例 | ⬜ | visualScale: number |

---

## 五、校准设置持久化

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 5.1 | Section.calibrationData 数据结构 | ⬜ | 扩展 Section 类型 |
| 5.2 | 保存画布缩放 | ⬜ | canvasScale |
| 5.3 | 保存锚点缩放 | ⬜ | anchorScale |
| 5.4 | 保存座位宽度 | ⬜ | seatVisual.width |
| 5.5 | 保存座位高度 | ⬜ | seatVisual.height |
| 5.6 | 保存横向间距 | ⬜ | seatVisual.gapX |
| 5.7 | 保存纵向间距 | ⬜ | seatVisual.gapY |
| 5.8 | 保存校准状态 | ⬜ | isCalibrated |
| 5.9 | 完成校准时自动保存 | ⬜ | |
| 5.10 | 重新进入时自动恢复 | ⬜ | |
| 5.11 | 有校准数据时跳过校准 | ⬜ | 直接进入编辑模式 |
| 5.12 | 重置校准数据功能 | ⬜ | 可选，重新校准 |

---

## 六、画布交互

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 6.1 | 滚轮缩放 | ⬜ | Ctrl+滚轮 |
| 6.2 | 以鼠标位置为中心缩放 | ⬜ | |
| 6.3 | 空格+拖拽平移 | ⬜ | |
| 6.4 | 中键拖拽平移 | ⬜ | |
| 6.5 | 双击空白处重置缩放 | ⬜ | 重置到 anchorScale |
| 6.6 | 缩放范围限制（50%-1000%） | ⬜ | 校准+编辑模式 |
| 6.7 | 画布边界限制 | ⬜ | 可选 |

---

## 七、快捷键

### 7.1 校准模式


### 7.2 编辑模式

| 序号 | 按键 | 功能 | 状态 |
|------|------|------|------|
| 7.2.7 | Delete | 删除选中座位 | ⬜ |
| 7.2.9 | Space+拖拽 | 平移画布 | ⬜ |

---

## 八、数据流与保存

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 8.1 | 世界坐标转局部坐标 | ⬜ | worldToLocal |
| 8.2 | 局部坐标转世界坐标 | ⬜ | localToWorld |
| 8.3 | 保存时坐标转换 | ⬜ | 局部→世界 |
| 8.4 | 更新 Section.seats | ⬜ | |
| 8.5 | 保存 calibrationData | ⬜ | |
| 8.6 | 未保存更改提示 | ⬜ | 退出时检查 |
| 8.7 | 撤销历史 | ⬜ | 编辑模式内 |
| 8.8 | 重做功能 | ⬜ | Ctrl+Y |

---

## 九、主画布集成

| 序号 | 功能点 | 状态 | 备注 |
|------|--------|------|------|
| 9.1 | 区域 hover 提示 | ⬜ | "双击编辑" |
| 9.2 | 选中区域时显示编辑入口 | ⬜ | 顶部浮动条 |
| 9.3 | 保存后主画布同步显示座位 | ⬜ | |
| 9.4 | 返回主画布保持视图状态 | ⬜ | 不重置缩放 |

---

## 十、文件清单

| 序号 | 文件路径 | 说明 | 状态 |
|------|----------|------|------|
| 10.1 | `app/src/types/index.ts` | 扩展 Section 类型 | ⬜ |
| 10.2 | `app/src/hooks/useSectionEdit.ts` | 状态管理 Hook | ⬜ |
| 10.3 | `app/src/components/section-edit/index.ts` | 组件导出 | ⬜ |
| 10.4 | `app/src/components/section-edit/SectionEditModal.tsx` | 主容器 | ⬜ |
| 10.5 | `app/src/components/section-edit/SectionEditCanvas.tsx` | 编辑画布 | ⬜ |
| 10.6 | `app/src/components/section-edit/CalibrationPanel.tsx` | 校准面板 | ⬜ |
| 10.7 | `app/src/components/section-edit/SeatPreview.tsx` | 预览座位 | ⬜ |
| 10.8 | `app/src/components/section-edit/SeatTools.tsx` | 座位工具栏 | ⬜ |
| 10.9 | `app/src/components/panels/PanelTop.tsx` | 添加 mode 支持 | ⬜ |
| 10.10 | `app/src/components/panels/PanelLeft.tsx` | 添加 mode 支持 | ⬜ |
| 10.11 | `app/src/components/panels/PanelRight.tsx` | 添加 mode 支持 | ⬜ |
| 10.12 | `app/src/utils/coordinate.ts` | 坐标转换函数 | ⬜ |

---

## 状态图例

| 符号 | 含义 |
|------|------|
| ⬜ | 未开始 |
| 🟡 | 进行中 |
| ✅ | 已完成 |
| ⏸️ | 暂停/阻塞 |

---

*文档创建日期: 2026-02-26*
*关联文档: plan/08.section-edit-mode.md*
