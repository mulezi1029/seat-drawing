# åŒºåŸŸç¼–è¾‘æ¨¡å¼å®ç°æ–‡æ¡£

> åŸºäº `plan/09.section-edit-features.md` åŠŸèƒ½ç‚¹æ¸…å•ç¼–å†™
> æœ¬æ–‡æ¡£æŒ‰å®ç°é˜¶æ®µç»„ç»‡ï¼Œç”¨äºæŒ‡å¯¼å¼€å‘

---

## æ¦‚è¿°

åŒºåŸŸç¼–è¾‘æ¨¡å¼å…è®¸ç”¨æˆ·"è¿›å…¥"æŸä¸ªå·²ç»˜åˆ¶åŒºåŸŸï¼Œåœ¨æ–°çš„ç”»å¸ƒå±‚ä¸­è¿›è¡Œåº§ä½ç»˜åˆ¶ã€‚é‡‡ç”¨**å¯è§†åŒ–æ ¡å‡†**æ–¹å¼â€”â€”é€šè¿‡äº¤äº’å¼ç¼©æ”¾å’Œåº§ä½å‚æ•°è®¾ç½®æ¥å®Œæˆæ ¡å‡†ã€‚

---

## æ•°æ®ç»“æ„å®šä¹‰

### 1. Section æ‰©å±•

```typescript
interface Section {
  id: string;
  name: string;
  points: Point[];
  color: string;
  seats: Seat[];
  opacity: number;
  /** æ ¡å‡†è®¾ç½®æŒä¹…åŒ– */
  calibrationData?: {
    canvasScale: number;
    anchorScale: number;
    seatVisual: {
      width: number;
      height: number;
      gapX: number;
      gapY: number;
    };
    isCalibrated: boolean;
  };
}
```

### 2. åº§ä½æ•°æ®ç»“æ„

```typescript
interface Seat {
  id: string;
  /** ä¸–ç•Œåæ ‡ç³»ä¸­çš„ä½ç½® */
  x: number;
  y: number;
  /** è¡Œå·ï¼Œå¦‚ "A" */
  row: string;
  /** åº§ä½å· */
  number: number;
  /** åº§ä½è§’åº¦ï¼ˆç›¸å¯¹äºæ­£åŒ—ï¼Œé¡ºæ—¶é’ˆï¼‰ */
  angle: number;
  /** åº§ä½ç±»å‹ */
  type: 'normal' | 'vip' | 'accessible' | 'empty';
  /** è§†è§‰å°ºå¯¸æ¯”ä¾‹ */
  visualScale: number;
}
```

### 3. åŒºåŸŸç¼–è¾‘çŠ¶æ€

```typescript
interface SectionEditState {
  /** æ˜¯å¦å¤„äºåŒºåŸŸç¼–è¾‘æ¨¡å¼ */
  isActive: boolean;
  /** æ­£åœ¨ç¼–è¾‘çš„åŒºåŸŸ ID */
  sectionId: string | null;
  /** å½“å‰é˜¶æ®µ */
  phase: 'calibrating' | 'editing';
  /** å¯è§†åŒ–æ ¡å‡†çŠ¶æ€ */
  calibration: {
    canvasScale: number;
    anchorScale: number;
    seatVisual: {
      width: number;
      height: number;
      gapX: number;
      gapY: number;
    };
    isCalibrated: boolean;
  };
  /** å½“å‰ç¼–è¾‘å·¥å…· */
  activeTool: 'select' | 'seat-row' | 'seat-matrix' | 'seat-arc';
  /** ç¼–è¾‘ä¸­çš„åº§ä½ */
  seats: Seat[];
  /** é€‰ä¸­çš„åº§ä½IDåˆ—è¡¨ */
  selectedSeatIds: string[];
  /** æ˜¯å¦æœ‰æœªä¿å­˜çš„æ›´æ”¹ */
  hasUnsavedChanges: boolean;
}
```

---

## ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¡†æ¶ä¸è¿›å…¥/é€€å‡º

**ç›®æ ‡**ï¼šå»ºç«‹åŒºåŸŸç¼–è¾‘æ¨¡å¼çš„åŸºç¡€æ¡†æ¶ï¼Œå®ç°è¿›å…¥å’Œé€€å‡ºåŠŸèƒ½ã€‚

### 1.1 ç±»å‹æ‰©å±• (10.1)

| åŠŸèƒ½ç‚¹ | æ–‡ä»¶ | è¯´æ˜ |
|--------|------|------|
| Section.calibrationData | `types/index.ts` | æ‰©å±• Section ç±»å‹ |

**å®ç°**ï¼š
```typescript
// types/index.ts
export interface Section {
  // ... ç°æœ‰å­—æ®µ
  calibrationData?: CalibrationData;
}

export interface CalibrationData {
  canvasScale: number;
  anchorScale: number;
  seatVisual: SeatVisualParams;
  isCalibrated: boolean;
}
```

### 1.2 çŠ¶æ€ç®¡ç† Hook (10.2)

| åŠŸèƒ½ç‚¹ | æ–‡ä»¶ | è¯´æ˜ |
|--------|------|------|
| useSectionEdit | `hooks/useSectionEdit.ts` | çŠ¶æ€ç®¡ç† Hook |

**å®ç°**ï¼š
```typescript
// hooks/useSectionEdit.ts
export function useSectionEdit() {
  const [state, setState] = useState<SectionEditState>({
    isActive: false,
    sectionId: null,
    phase: 'calibrating',
    calibration: {
      canvasScale: 1,
      anchorScale: 1,
      seatVisual: { width: 20, height: 20, gapX: 5, gapY: 5 },
      isCalibrated: false,
    },
    activeTool: 'select',
    seats: [],
    selectedSeatIds: [],
    hasUnsavedChanges: false,
  });

  const enterEditMode = useCallback((section: Section) => {
    // æ£€æŸ¥æ˜¯å¦å·²æœ‰æ ¡å‡†æ•°æ®
    const hasCalibration = section.calibrationData?.isCalibrated;
    // ... åˆå§‹åŒ–çŠ¶æ€
  }, []);

  const exitEditMode = useCallback(() => {
    // ... é€€å‡ºé€»è¾‘
  }, []);

  return { state, setState, enterEditMode, exitEditMode };
}
```

### 1.3 ä¸»å®¹å™¨ç»„ä»¶ (10.4)

| åŠŸèƒ½ç‚¹ | æ–‡ä»¶ | è¯´æ˜ |
|--------|------|------|
| SectionEditModal | `components/section-edit/SectionEditModal.tsx` | ä¸»å®¹å™¨ |

**å®ç°è¦ç‚¹**ï¼š
- å…¨å±æ¨¡æ€æ¡†è¦†ç›–
- æ ¹æ® phase æ˜¾ç¤ºä¸åŒå¸ƒå±€
- ä¼ é€’çŠ¶æ€å’Œæ–¹æ³•ç»™å­ç»„ä»¶

### 1.4 è¿›å…¥æ–¹å¼ (1.1, 1.3, 1.4)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| åŒå‡»åŒºåŸŸè¿›å…¥ | â¬œ | ä¸»ç”»å¸ƒåŒºåŸŸåŒå‡»äº‹ä»¶ |
| å·¥å…·æ "è¿›å…¥ç¼–è¾‘"æŒ‰é’® | â¬œ | é€‰ä¸­åŒºåŸŸæ—¶æ˜¾ç¤º |
| Enter å¿«æ·é”®è¿›å…¥ | â¬œ | éœ€é€‰ä¸­å•ä¸ªåŒºåŸŸ |

**å®ç°**ï¼š
```typescript
// Canvas.tsx - åŒå‡»å¤„ç†
const handleSectionDoubleClick = (section: Section) => {
  enterEditMode(section);
};

// é€‰ä¸­åŒºåŸŸæ—¶çš„å·¥å…·æ æŒ‰é’®
{selectedSection && (
  <button onClick={() => enterEditMode(selectedSection)}>
    è¿›å…¥ç¼–è¾‘
  </button>
)}

// å¿«æ·é”®å¤„ç†
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    if (e.key === 'Enter' && selectedSections.length === 1) {
      enterEditMode(selectedSections[0]);
    }
  };
  // ...
}, [selectedSections]);
```

### 1.5 è¿›å…¥å‰æ£€æŸ¥ (1.5, 1.6)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| å•é€‰æ£€æŸ¥ | â¬œ | å¤šé€‰æ—¶æç¤º"è¯·åªé€‰æ‹©ä¸€ä¸ªåŒºåŸŸ" |
| å¤šè¾¹å½¢æœ‰æ•ˆæ€§æ£€æŸ¥ | â¬œ | points.length >= 3 |

**å®ç°**ï¼š
```typescript
const enterEditMode = (section: Section) => {
  if (selectedSections.length !== 1) {
    alert('è¯·åªé€‰æ‹©ä¸€ä¸ªåŒºåŸŸè¿›è¡Œç¼–è¾‘');
    return;
  }
  if (section.points.length < 3) {
    alert('è¯¥åŒºåŸŸæ²¡æœ‰æœ‰æ•ˆçš„å¤šè¾¹å½¢è¾¹ç•Œ');
    return;
  }
  // ... è¿›å…¥ç¼–è¾‘æ¨¡å¼
};
```

### 1.6 é€€å‡ºä¸ä¿å­˜ (1.7, 1.9)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| ç‚¹å‡»è¿”å›æŒ‰é’®é€€å‡º | â¬œ | é¡¶éƒ¨é¢æ¿è¿”å›æŒ‰é’® |
| ä¿å­˜åé€€å‡º | â¬œ | ä¿å­˜åº§ä½+æ ¡å‡†æ•°æ® |

**å®ç°**ï¼š
```typescript
const handleSave = () => {
  // è½¬æ¢åæ ‡
  const worldSeats = seats.map(seat => ({
    ...seat,
    x: seat.x + bounds.minX,
    y: seat.y + bounds.minY,
  }));

  // ä¿å­˜åˆ° Section
  onSaveSection({
    ...section,
    seats: worldSeats,
    calibrationData: calibration,
  });

  exitEditMode();
};
```

---

## ç¬¬äºŒé˜¶æ®µï¼šæ ¡å‡†æ¨¡å¼

**ç›®æ ‡**ï¼šå®ç°å¯è§†åŒ–æ ¡å‡†ç•Œé¢ï¼Œè®©ç”¨æˆ·è°ƒæ•´ç”»å¸ƒç¼©æ”¾å’Œåº§ä½å‚æ•°ã€‚

### 2.1 æ ¡å‡†ç”»å¸ƒ (2.1.x)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| æ˜¾ç¤ºå®Œæ•´åº•å›¾ SVG èƒŒæ™¯ | â¬œ | opacity: 0.7 |
| åŒºåŸŸå†…éƒ¨åº•å›¾é«˜äº®æ˜¾ç¤º | â¬œ | clipPath è£å‰ª, opacity: 0.8 |
| åŒºåŸŸå¤–éƒ¨åŠé€æ˜é®ç½© | â¬œ | mask å®ç°, opacity: 0.5 |
| åŒºåŸŸè¾¹æ¡†ï¼ˆè™šçº¿ï¼‰ | â¬œ | strokeDasharray |
| ç”»å¸ƒç¼©æ”¾ 50% - 1000% | â¬œ | æ»‘å—+æ»šè½®æ§åˆ¶ |
| ç”»å¸ƒå¹³ç§»ï¼ˆç©ºæ ¼+æ‹–æ‹½ï¼‰ | â¬œ | |
| è‡ªåŠ¨å±…ä¸­å®šä½åŒºåŸŸ | â¬œ | ResizeObserver |

**å®ç°**ï¼š`components/section-edit/SectionEditCanvas.tsx`

```tsx
<svg width={WORLD_SIZE} height={WORLD_SIZE}>
  <g transform={worldLayerTransform}>
    {/* å®Œæ•´åº•å›¾èƒŒæ™¯ */}
    {svgUrl && (
      <image
        href={svgUrl}
        x={svgX}
        y={svgY}
        width={svgWidth}
        height={svgHeight}
        opacity={0.7}
      />
    )}

    {/* åŒºåŸŸé«˜äº®ï¼ˆè£å‰ªæ˜¾ç¤ºï¼‰ */}
    <g clipPath="url(#section-clip)">
      {svgUrl && (
        <image
          href={svgUrl}
          x={svgX}
          y={svgY}
          width={svgWidth}
          height={svgHeight}
          opacity={0.8}
        />
      )}
    </g>

    {/* åŒºåŸŸå¤–éƒ¨é®ç½© */}
    <mask id="section-mask">
      <rect x={0} y={0} width={WORLD_SIZE} height={WORLD_SIZE} fill="white" />
      <polygon points={pointsString} fill="black" />
    </mask>
    <rect
      x={0} y={0} width={WORLD_SIZE} height={WORLD_SIZE}
      fill="black"
      opacity={0.5}
      mask="url(#section-mask)"
    />

    {/* åŒºåŸŸè¾¹æ¡† */}
    <polygon
      points={pointsString}
      fill="none"
      stroke={section.color}
      strokeWidth={2 / canvasScale}
      strokeDasharray="5,5"
    />
  </g>
</svg>
```

### 2.2 æ ¡å‡†é¢æ¿ (2.2.x)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| ç”»å¸ƒç¼©æ”¾æ»‘å—ï¼ˆ50%-1000%ï¼‰ | â¬œ | |
| é¢„è§ˆçŸ©é˜µåˆ‡æ¢æŒ‰é’® | â¬œ | 2Ã—2, 3Ã—3, 4Ã—4, 5Ã—5, å®é™… |
| é¢„è®¡å®¹é‡è®¡ç®—æ˜¾ç¤º | â¬œ | æ ¹æ®å‚æ•°è®¡ç®— |
| é‡ç½®æŒ‰é’® | â¬œ | Ré”®å¿«æ·é”® |

**å®ç°**ï¼š`components/section-edit/CalibrationPanel.tsx`

```tsx
<div className="calibration-panel">
  {/* ç”»å¸ƒç¼©æ”¾ */}
  <div className="control-group">
    <label>ç”»å¸ƒç¼©æ”¾</label>
    <Slider
      min={0.5}
      max={10}
      step={0.1}
      value={canvasScale}
      onChange={setCanvasScale}
    />
    <span>{Math.round(canvasScale * 100)}%</span>
  </div>

  {/* é¢„è§ˆçŸ©é˜µ */}
  <div className="preview-options">
    {['2Ã—2', '3Ã—3', '4Ã—4', '5Ã—5', 'å®é™…'].map(size => (
      <button key={size} onClick={() => setPreviewSize(size)}>
        {size}
      </button>
    ))}
  </div>

  {/* é¢„è®¡å®¹é‡ */}
  <div className="capacity-estimate">
    é¢„è®¡å®¹é‡: {estimatedRows} æ’ Ã— {estimatedCols} åˆ— = {estimatedCapacity} åº§ä½
  </div>

  {/* æ“ä½œæŒ‰é’® */}
  <div className="actions">
    <button onClick={resetCalibration}>é‡ç½® (R)</button>
    <button onClick={completeCalibration}>å¼€å§‹ç»˜åˆ¶åº§ä½</button>
  </div>
</div>
```

### 2.3 é¢„è§ˆåº§ä½ (10.7)

| åŠŸèƒ½ç‚¹ | æ–‡ä»¶ | è¯´æ˜ |
|--------|------|------|
| SeatPreview | `components/section-edit/SeatPreview.tsx` | é¢„è§ˆåº§ä½çŸ©é˜µ |

**å®ç°è¦ç‚¹**ï¼š
- æ ¹æ®é¢„è§ˆçŸ©é˜µå¤§å°ç”Ÿæˆåº§ä½
- ä½¿ç”¨æ ¡å‡†çš„åº§ä½å°ºå¯¸å’Œé—´è·
- æ˜¾ç¤ºåœ¨ç”»å¸ƒä¸­å¿ƒ

---

## ç¬¬ä¸‰é˜¶æ®µï¼šç¼–è¾‘æ¨¡å¼ç•Œé¢

**ç›®æ ‡**ï¼šå®ç°ä¸ä¸»ä¸–ç•Œä¸€è‡´çš„å®Œæ•´ç•Œé¢ç»“æ„ã€‚

### 3.1 é¡¶éƒ¨é¢æ¿é€‚é… (3.1.x, 10.9)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| è¿”å›æŒ‰é’® | â¬œ | å¸¦è¿”å›å›¾æ ‡ |
| åŒºåŸŸåç§°æ˜¾ç¤º | â¬œ | æ ¼å¼ï¼š"åŒºåŸŸ A - åº§ä½ç¼–è¾‘" |
| ä¿å­˜æŒ‰é’® | â¬œ | ä¿å­˜åº§ä½æ•°æ® |
| å¸®åŠ©æŒ‰é’® | â¬œ | æ˜¾ç¤ºå¿«æ·é”®è¯´æ˜ |
| PanelTop mode="section-edit" æ”¯æŒ | â¬œ | |

**å®ç°**ï¼š
```tsx
// PanelTop.tsx
interface PanelTopProps {
  mode?: 'main' | 'section-edit';
  sectionName?: string;
  onBack?: () => void;
  onSave?: () => void;
}

// ç¼–è¾‘æ¨¡å¼ UI
<div className="panel-top">
  <button onClick={onBack}>
    <ArrowLeftIcon /> è¿”å›
  </button>
  <span>{sectionName} - åº§ä½ç¼–è¾‘</span>
  <div className="actions">
    <button onClick={onSave}>ä¿å­˜</button>
    <button>?</button>
  </div>
</div>
```

### 3.2 å·¦ä¾§é¢æ¿é€‚é… (3.2.x, 10.10)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| é€‰æ‹©å·¥å…·ï¼ˆVï¼‰ | â¬œ | |
| å•æ’åº§ä½å·¥å…·ï¼ˆ1ï¼‰ | â¬œ | |
| çŸ©é˜µåº§ä½å·¥å…·ï¼ˆ2ï¼‰ | â¬œ | |
| å¼§çº¿æ’åˆ—å·¥å…·ï¼ˆ3ï¼‰ | â¬œ | |
| å·¥å…·æ¿€æ´»çŠ¶æ€æ˜¾ç¤º | â¬œ | |
| å·¥å…·å¿«æ·é”®æç¤º | â¬œ | æ ‡ç­¾æ˜¾ç¤º (V), (1), (2), (3) |

**å®ç°**ï¼š
```tsx
// PanelLeft.tsx - ç¼–è¾‘æ¨¡å¼å·¥å…·
const sectionEditTools = [
  { id: 'select', icon: MousePointer, label: 'é€‰æ‹©', shortcut: 'V' },
  { id: 'seat-row', icon: Plus, label: 'å•æ’åº§ä½', shortcut: '1' },
  { id: 'seat-matrix', icon: Grid3x3, label: 'çŸ©é˜µåº§ä½', shortcut: '2' },
  { id: 'seat-arc', icon: Circle, label: 'å¼§çº¿æ’åˆ—', shortcut: '3' },
];
```

### 3.3 å³ä¾§é¢æ¿é€‚é… (3.3.x, 10.11)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| åº§ä½å±æ€§åŒºåŸŸ | â¬œ | |
| è¡Œå·è¾“å…¥æ¡† | â¬œ | |
| åº§ä½å·è¾“å…¥æ¡† | â¬œ | |
| åº§ä½ç±»å‹ä¸‹æ‹‰ | â¬œ | æ­£å¸¸/VIP/æ— éšœç¢/ç©ºä½ |
| åº§ä½è§’åº¦è¾“å…¥ | â¬œ | 0-360Â° |
| é€‰ä¸­åº§ä½ä¿¡æ¯å±•ç¤º | â¬œ | æœªé€‰ä¸­æ—¶æ˜¾ç¤ºæç¤º |

**å®ç°**ï¼š
```tsx
// PanelRight.tsx - ç¼–è¾‘æ¨¡å¼å†…å®¹
{mode === 'section-edit' && selectedSeat && (
  <div className="seat-properties">
    <h3>åº§ä½å±æ€§</h3>
    <div className="form-group">
      <label>è¡Œå·</label>
      <input
        value={selectedSeat.row}
        onChange={e => updateSeat({ row: e.target.value })}
      />
    </div>
    <div className="form-group">
      <label>åº§ä½å·</label>
      <input
        type="number"
        value={selectedSeat.number}
        onChange={e => updateSeat({ number: +e.target.value })}
      />
    </div>
    <div className="form-group">
      <label>ç±»å‹</label>
      <select
        value={selectedSeat.type}
        onChange={e => updateSeat({ type: e.target.value })}
      >
        <option value="normal">æ­£å¸¸</option>
        <option value="vip">VIP</option>
        <option value="accessible">æ— éšœç¢</option>
        <option value="empty">ç©ºä½</option>
      </select>
    </div>
    <div className="form-group">
      <label>è§’åº¦</label>
      <input
        type="number"
        min={0}
        max={360}
        value={selectedSeat.angle}
        onChange={e => updateSeat({ angle: +e.target.value })}
      />
    </div>
  </div>
)}
```

### 3.4 æ‚¬æµ®æ§ä»¶ (3.4.x)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| æ‘‡æ†æ§åˆ¶ï¼ˆä¸Š/ä¸‹/å·¦/å³ï¼‰ | â¬œ | |
| ç¼©æ”¾æ§åˆ¶ï¼ˆ+/-ï¼‰ | â¬œ | |
| é‡ç½®ä¸­å¿ƒæŒ‰é’® | â¬œ | |
| çŠ¶æ€æ æ˜¾ç¤º | â¬œ | åæ ‡/æ’æ•°/åº§ä½æ•° |

**å®ç°**ï¼šå¤ç”¨ç°æœ‰çš„ FloatingControls ç»„ä»¶

---

## ç¬¬å››é˜¶æ®µï¼šåº§ä½ç»˜åˆ¶åŠŸèƒ½

**ç›®æ ‡**ï¼šå®ç°åº§ä½ç»˜åˆ¶ã€é€‰æ‹©å’Œç¼–è¾‘åŠŸèƒ½ã€‚

### 4.1 ç»˜åˆ¶å·¥å…· (4.1.x)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| å•æ’åº§ä½æ”¾ç½® | â¬œ | ç‚¹å‡»ç”»å¸ƒæ”¾ç½® |
| çŸ©é˜µæ‹–æ‹½ç»˜åˆ¶ | â¬œ | æ‹–æ‹½ç¡®å®šè¡Œåˆ— |
| çŸ©é˜µè¡Œæ•°è®¡ç®— | â¬œ | æ ¹æ®æ‹–æ‹½è·ç¦» |
| çŸ©é˜µåˆ—æ•°è®¡ç®— | â¬œ | æ ¹æ®æ‹–æ‹½è·ç¦» |
| ä½¿ç”¨æ ¡å‡†é»˜è®¤é—´è· | â¬œ | çŸ©é˜µç»˜åˆ¶æ—¶ |
| å®æ—¶é¢„è§ˆçŸ©é˜µèŒƒå›´ | â¬œ | æ‹–æ‹½æ—¶æ˜¾ç¤ºè™šçº¿æ¡† |

**å®ç°è¦ç‚¹**ï¼š
```typescript
// çŸ©é˜µç»˜åˆ¶é€»è¾‘
const handleMouseDown = (e: MouseEvent) => {
  setDragStart({ x: e.clientX, y: e.clientY });
  setIsDragging(true);
};

const handleMouseMove = (e: MouseEvent) => {
  if (!isDragging) return;

  const dx = e.clientX - dragStart.x;
  const dy = e.clientY - dragStart.y;

  // æ ¹æ®è·ç¦»å’Œé—´è·è®¡ç®—è¡Œåˆ—æ•°
  const cols = Math.max(1, Math.floor(dx / (seatVisual.width + seatVisual.gapX)));
  const rows = Math.max(1, Math.floor(dy / (seatVisual.height + seatVisual.gapY)));

  setPreviewMatrix({ rows, cols });
};

const handleMouseUp = () => {
  if (isDragging && previewMatrix) {
    generateSeats(previewMatrix.rows, previewMatrix.cols);
  }
  setIsDragging(false);
  setPreviewMatrix(null);
};
```

### 4.2 åº§ä½é€‰æ‹© (4.2.x)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| å•å‡»é€‰æ‹©å•ä¸ªåº§ä½ | â¬œ | |
| æ¡†é€‰å¤šä¸ªåº§ä½ | â¬œ | |
| Ctrl+å•å‡»å¤šé€‰ | â¬œ | |
| é€‰æ‹©æ¡†å®æ—¶æ˜¾ç¤º | â¬œ | |
| é€‰ä¸­åº§ä½é«˜äº® | â¬œ | è¾¹æ¡†æˆ–èƒŒæ™¯è‰²å˜åŒ– |

**å®ç°è¦ç‚¹**ï¼š
```typescript
// é€‰æ‹©é€»è¾‘
const handleSeatClick = (seatId: string, e: MouseEvent) => {
  if (e.ctrlKey || e.metaKey) {
    // Ctrl+å•å‡»ï¼šåˆ‡æ¢é€‰æ‹©
    toggleSeatSelection(seatId);
  } else {
    // å•å‡»ï¼šå•é€‰
    selectSingleSeat(seatId);
  }
};

// æ¡†é€‰é€»è¾‘
const handleSelectionBox = (start: Point, end: Point) => {
  const selectedIds = seats
    .filter(seat => isPointInBox({ x: seat.x, y: seat.y }, start, end))
    .map(seat => seat.id);
  setSelectedSeatIds(selectedIds);
};
```

### 4.3 åº§ä½ç¼–è¾‘ (4.3.x)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| æ‹–æ‹½ç§»åŠ¨åº§ä½ | â¬œ | å®æ—¶é¢„è§ˆ |
| æ‰¹é‡ç§»åŠ¨åº§ä½ | â¬œ | å¤šé€‰æ—¶ |
| Delete åˆ é™¤åº§ä½ | â¬œ | |
| æ‰¹é‡åˆ é™¤åº§ä½ | â¬œ | å¤šé€‰æ—¶ |
| ä¿®æ”¹è¡Œå· | â¬œ | å³ä¾§é¢æ¿ |
| ä¿®æ”¹åº§ä½å· | â¬œ | å³ä¾§é¢æ¿ |
| ä¿®æ”¹åº§ä½ç±»å‹ | â¬œ | å³ä¾§é¢æ¿ |
| ä¿®æ”¹åº§ä½è§’åº¦ | â¬œ | å³ä¾§é¢æ¿ |

---

## ç¬¬äº”é˜¶æ®µï¼šåæ ‡è½¬æ¢ä¸æ•°æ®æµ

**ç›®æ ‡**ï¼šå®ç°ä¸–ç•Œåæ ‡ä¸å±€éƒ¨åæ ‡çš„è½¬æ¢ï¼Œä»¥åŠæ•°æ®çš„ä¿å­˜å’Œæ¢å¤ã€‚

### 5.1 åæ ‡è½¬æ¢å·¥å…· (10.12)

| åŠŸèƒ½ç‚¹ | æ–‡ä»¶ | è¯´æ˜ |
|--------|------|------|
| worldToLocal | `utils/coordinate.ts` | ä¸–ç•Œåæ ‡è½¬å±€éƒ¨åæ ‡ |
| localToWorld | `utils/coordinate.ts` | å±€éƒ¨åæ ‡è½¬ä¸–ç•Œåæ ‡ |

**å®ç°**ï¼š
```typescript
// utils/coordinate.ts
export function worldToLocal(
  worldPoint: Point,
  bounds: BoundingBox
): Point {
  return {
    x: worldPoint.x - bounds.minX,
    y: worldPoint.y - bounds.minY,
  };
}

export function localToWorld(
  localPoint: Point,
  bounds: BoundingBox
): Point {
  return {
    x: localPoint.x + bounds.minX,
    y: localPoint.y + bounds.minY,
  };
}
```

### 5.2 ä¿å­˜æ—¶åæ ‡è½¬æ¢ (8.3)

| åŠŸèƒ½ç‚¹ | è¯´æ˜ |
|--------|------|
| ä¿å­˜æ—¶åæ ‡è½¬æ¢ | å±€éƒ¨â†’ä¸–ç•Œ |
| æ›´æ–° Section.seats | |
| ä¿å­˜ calibrationData | |

**å®ç°**ï¼š
```typescript
const saveSeats = () => {
  const worldSeats = seats.map(seat => ({
    ...seat,
    x: seat.x + sectionBounds.minX,
    y: seat.y + sectionBounds.minY,
  }));

  onUpdateSection({
    ...section,
    seats: worldSeats,
    calibrationData: state.calibration,
  });
};
```

### 5.3 æ ¡å‡†è®¾ç½®æŒä¹…åŒ– (5.x)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| å®Œæˆæ ¡å‡†æ—¶è‡ªåŠ¨ä¿å­˜ | â¬œ | |
| é‡æ–°è¿›å…¥æ—¶è‡ªåŠ¨æ¢å¤ | â¬œ | |
| æœ‰æ ¡å‡†æ•°æ®æ—¶è·³è¿‡æ ¡å‡† | â¬œ | ç›´æ¥è¿›å…¥ç¼–è¾‘æ¨¡å¼ |

**å®ç°**ï¼š
```typescript
const completeCalibration = () => {
  const calibrationData = {
    canvasScale: state.calibration.canvasScale,
    anchorScale: state.calibration.canvasScale,
    seatVisual: state.calibration.seatVisual,
    isCalibrated: true,
  };

  // ä¿å­˜åˆ°æ ¡å‡†æ•°æ®
  onSaveCalibration(sectionId, calibrationData);

  // åˆ‡æ¢åˆ°ç¼–è¾‘é˜¶æ®µ
  setState(prev => ({ ...prev, phase: 'editing' }));
};

// è¿›å…¥æ—¶æ¢å¤
const enterEditMode = (section: Section) => {
  const hasCalibration = section.calibrationData?.isCalibrated;

  setState({
    isActive: true,
    sectionId: section.id,
    phase: hasCalibration ? 'editing' : 'calibrating',
    calibration: section.calibrationData ?? defaultCalibration,
    // ...
  });
};
```

---

## ç¬¬å…­é˜¶æ®µï¼šç”»å¸ƒäº¤äº’

**ç›®æ ‡**ï¼šå®ç°ä¸ä¸»ç”»å¸ƒä¸€è‡´çš„ç”»å¸ƒäº¤äº’ä½“éªŒã€‚

### 6.1 äº¤äº’åŠŸèƒ½ (6.x)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| æ»šè½®ç¼©æ”¾ | â¬œ | Ctrl+æ»šè½® |
| ä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒç¼©æ”¾ | â¬œ | |
| ç©ºæ ¼+æ‹–æ‹½å¹³ç§» | â¬œ | |
| ä¸­é”®æ‹–æ‹½å¹³ç§» | â¬œ | |
| åŒå‡»ç©ºç™½å¤„é‡ç½®ç¼©æ”¾ | â¬œ | é‡ç½®åˆ° anchorScale |
| ç¼©æ”¾èŒƒå›´é™åˆ¶ï¼ˆ50%-1000%ï¼‰ | â¬œ | |

**å®ç°è¦ç‚¹**ï¼šå‚ç…§ä¸»ç”»å¸ƒ Canvas.tsx çš„å®ç°ï¼Œä¿æŒä¸€è‡´æ€§ã€‚

```typescript
// ç¼©æ”¾å¤„ç†ï¼ˆä¸ä¸»ç”»å¸ƒä¸€è‡´ï¼‰
const handleWheel = useCallback((e: React.WheelEvent) => {
  if (e.ctrlKey || e.metaKey) {
    e.preventDefault();
    const delta = e.deltaY > 0 ? 0.9 : 1.1;
    const newScale = Math.max(0.5, Math.min(10, canvasScale * delta));

    // ä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒç¼©æ”¾
    const rect = containerRef.current?.getBoundingClientRect();
    if (rect) {
      const mouseX = e.clientX - rect.left + containerRef.current!.scrollLeft;
      const mouseY = e.clientY - rect.top + containerRef.current!.scrollTop;
      setCanvasScale(newScale, mouseX, mouseY);
    }
  }
}, [canvasScale]);
```

---

## ç¬¬ä¸ƒé˜¶æ®µï¼šå¿«æ·é”®

**ç›®æ ‡**ï¼šå®ç°ç¼–è¾‘æ¨¡å¼çš„å¿«æ·é”®æ”¯æŒã€‚

### 7.1 å¿«æ·é”®æ˜ å°„ (7.x)

| æ¨¡å¼ | æŒ‰é”® | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| æ ¡å‡† | `Space` | å¼€å§‹ç»˜åˆ¶åº§ä½ | â¬œ |
| æ ¡å‡† | `R` | é‡ç½®æ‰€æœ‰å‚æ•° | â¬œ |
| ç¼–è¾‘ | `V` | é€‰æ‹©å·¥å…· | â¬œ |
| ç¼–è¾‘ | `1` | å•æ’å·¥å…· | â¬œ |
| ç¼–è¾‘ | `2` | çŸ©é˜µå·¥å…· | â¬œ |
| ç¼–è¾‘ | `3` | å¼§çº¿å·¥å…· | â¬œ |
| ç¼–è¾‘ | `Delete` | åˆ é™¤é€‰ä¸­åº§ä½ | â¬œ |
| å…¨å±€ | `Esc` | é€€å‡ºç¼–è¾‘æ¨¡å¼ | â¬œ |

---

## ç¬¬å…«é˜¶æ®µï¼šä¸»ç”»å¸ƒé›†æˆ

**ç›®æ ‡**ï¼šå®ç°ä¸ä¸»ç”»å¸ƒçš„é›†æˆã€‚

### 8.1 ä¸»ç”»å¸ƒå¢å¼º (9.x)

| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| åŒºåŸŸ hover æç¤º | â¬œ | "åŒå‡»ç¼–è¾‘" |
| é€‰ä¸­åŒºåŸŸæ—¶æ˜¾ç¤ºç¼–è¾‘å…¥å£ | â¬œ | é¡¶éƒ¨æµ®åŠ¨æ¡ |
| ä¿å­˜åä¸»ç”»å¸ƒåŒæ­¥æ˜¾ç¤ºåº§ä½ | â¬œ | |
| è¿”å›ä¸»ç”»å¸ƒä¿æŒè§†å›¾çŠ¶æ€ | â¬œ | ä¸é‡ç½®ç¼©æ”¾ |

---

## æ–‡ä»¶æ¸…å•

| åºå· | æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|------|----------|------|------|
| 10.1 | `app/src/types/index.ts` | æ‰©å±• Section ç±»å‹ | â¬œ |
| 10.2 | `app/src/hooks/useSectionEdit.ts` | çŠ¶æ€ç®¡ç† Hook | â¬œ |
| 10.3 | `app/src/components/section-edit/index.ts` | ç»„ä»¶å¯¼å‡º | â¬œ |
| 10.4 | `app/src/components/section-edit/SectionEditModal.tsx` | ä¸»å®¹å™¨ | â¬œ |
| 10.5 | `app/src/components/section-edit/SectionEditCanvas.tsx` | ç¼–è¾‘ç”»å¸ƒ | â¬œ |
| 10.6 | `app/src/components/section-edit/CalibrationPanel.tsx` | æ ¡å‡†é¢æ¿ | â¬œ |
| 10.7 | `app/src/components/section-edit/SeatPreview.tsx` | é¢„è§ˆåº§ä½ | â¬œ |
| 10.8 | `app/src/components/section-edit/SeatTools.tsx` | åº§ä½å·¥å…·æ  | â¬œ |
| 10.9 | `app/src/components/panels/PanelTop.tsx` | æ·»åŠ  mode æ”¯æŒ | â¬œ |
| 10.10 | `app/src/components/panels/PanelLeft.tsx` | æ·»åŠ  mode æ”¯æŒ | â¬œ |
| 10.11 | `app/src/components/panels/PanelRight.tsx` | æ·»åŠ  mode æ”¯æŒ | â¬œ |
| 10.12 | `app/src/utils/coordinate.ts` | åæ ‡è½¬æ¢å‡½æ•° | â¬œ |

---

## å®ç°ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆåŸºç¡€åŠŸèƒ½ï¼‰

1. ç±»å‹å®šä¹‰æ‰©å±•ï¼ˆSection.calibrationDataï¼‰
2. useSectionEdit Hook
3. SectionEditModal ä¸»å®¹å™¨
4. è¿›å…¥/é€€å‡ºç¼–è¾‘æ¨¡å¼
5. æ ¡å‡†ç”»å¸ƒåŸºç¡€å®ç°ï¼ˆèƒŒæ™¯ã€é®ç½©ï¼‰
6. æ ¡å‡†é¢æ¿ UI

### ä¸­ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

7. é¢æ¿é€‚é…ï¼ˆPanelTop/Left/Right mode æ”¯æŒï¼‰
8. åº§ä½ç»˜åˆ¶å·¥å…·ï¼ˆå•æ’ã€çŸ©é˜µï¼‰
9. åº§ä½é€‰æ‹©åŠŸèƒ½
10. åæ ‡è½¬æ¢å·¥å…·
11. æ ¡å‡†è®¾ç½®æŒä¹…åŒ–

### ä½ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–åŠŸèƒ½ï¼‰

12. å¼§çº¿æ’åˆ—å·¥å…·
13. å¿«æ·é”®æ”¯æŒ
14. æ’¤é”€é‡åš
15. ä¸»ç”»å¸ƒé›†æˆå¢å¼º

---

## çŠ¶æ€å›¾ä¾‹

| ç¬¦å· | å«ä¹‰ |
|------|------|
| â¬œ | æœªå¼€å§‹ |
| ğŸŸ¡ | è¿›è¡Œä¸­ |
| âœ… | å·²å®Œæˆ |
| â¸ï¸ | æš‚åœ/é˜»å¡ |

---

*æ–‡æ¡£åˆ›å»ºæ—¥æœŸ: 2026-02-26*
*å…³è”æ–‡æ¡£: plan/09.section-edit-features.md, plan/08.section-edit-mode.md*
