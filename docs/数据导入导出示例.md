# 数据导入导出示例

本文档提供数据导入导出功能的实际示例和测试数据。

---

## 示例 1：简单场馆

### 导出数据

```json
{
  "version": "1.0.0",
  "timestamp": "2026-02-26T10:30:00.000Z",
  "venueName": "小型剧场",
  "backgroundImage": null,
  "sections": [
    {
      "id": "section-1708934400000",
      "name": "A区",
      "points": [
        { "x": 100, "y": 100 },
        { "x": 500, "y": 100 },
        { "x": 500, "y": 400 },
        { "x": 100, "y": 400 }
      ],
      "color": "#3b82f6",
      "opacity": 0.3,
      "seats": [
        {
          "id": "seat-1708934400000-0",
          "x": 50,
          "y": 50,
          "row": "A",
          "number": 1,
          "type": "normal",
          "angle": 0
        },
        {
          "id": "seat-1708934400000-1",
          "x": 100,
          "y": 50,
          "row": "A",
          "number": 2,
          "type": "normal",
          "angle": 0
        },
        {
          "id": "seat-1708934400000-2",
          "x": 150,
          "y": 50,
          "row": "A",
          "number": 3,
          "type": "normal",
          "angle": 0
        }
      ],
      "calibrationData": {
        "canvasScale": 3.0,
        "anchorScale": 3.0,
        "seatVisual": {
          "size": 35,
          "gapX": 15,
          "gapY": 25
        },
        "isCalibrated": true
      }
    }
  ],
  "metadata": {
    "totalSections": 1,
    "totalSeats": 3,
    "createdAt": "2026-02-26T10:00:00.000Z",
    "modifiedAt": "2026-02-26T10:30:00.000Z"
  }
}
```

### 使用步骤

1. 复制上述 JSON 内容
2. 保存为 `small-theater.json`
3. 在应用中点击导入按钮
4. 选择该文件
5. 确认导入

---

## 示例 2：多区域场馆

### 导出数据

```json
{
  "version": "1.0.0",
  "timestamp": "2026-02-26T11:00:00.000Z",
  "venueName": "大型体育馆",
  "backgroundImage": null,
  "sections": [
    {
      "id": "section-1708934400001",
      "name": "VIP区",
      "points": [
        { "x": 100, "y": 100 },
        { "x": 300, "y": 100 },
        { "x": 300, "y": 300 },
        { "x": 100, "y": 300 }
      ],
      "color": "#f59e0b",
      "opacity": 0.3,
      "seats": [
        {
          "id": "seat-vip-1",
          "x": 50,
          "y": 50,
          "row": "V",
          "number": 1,
          "type": "vip",
          "angle": 0
        },
        {
          "id": "seat-vip-2",
          "x": 100,
          "y": 50,
          "row": "V",
          "number": 2,
          "type": "vip",
          "angle": 0
        }
      ],
      "calibrationData": {
        "canvasScale": 3.0,
        "anchorScale": 3.0,
        "seatVisual": {
          "size": 40,
          "gapX": 20,
          "gapY": 30
        },
        "isCalibrated": true
      }
    },
    {
      "id": "section-1708934400002",
      "name": "普通区",
      "points": [
        { "x": 400, "y": 100 },
        { "x": 800, "y": 100 },
        { "x": 800, "y": 500 },
        { "x": 400, "y": 500 }
      ],
      "color": "#3b82f6",
      "opacity": 0.3,
      "seats": [
        {
          "id": "seat-normal-1",
          "x": 50,
          "y": 50,
          "row": "A",
          "number": 1,
          "type": "normal",
          "angle": 0
        },
        {
          "id": "seat-normal-2",
          "x": 100,
          "y": 50,
          "row": "A",
          "number": 2,
          "type": "normal",
          "angle": 0
        }
      ],
      "calibrationData": {
        "canvasScale": 3.0,
        "anchorScale": 3.0,
        "seatVisual": {
          "size": 35,
          "gapX": 15,
          "gapY": 25
        },
        "isCalibrated": true
      }
    },
    {
      "id": "section-1708934400003",
      "name": "无障碍区",
      "points": [
        { "x": 100, "y": 400 },
        { "x": 300, "y": 400 },
        { "x": 300, "y": 600 },
        { "x": 100, "y": 600 }
      ],
      "color": "#10b981",
      "opacity": 0.3,
      "seats": [
        {
          "id": "seat-accessible-1",
          "x": 50,
          "y": 50,
          "row": "W",
          "number": 1,
          "type": "accessible",
          "angle": 0
        }
      ],
      "calibrationData": {
        "canvasScale": 3.0,
        "anchorScale": 3.0,
        "seatVisual": {
          "size": 45,
          "gapX": 25,
          "gapY": 35
        },
        "isCalibrated": true
      }
    }
  ],
  "metadata": {
    "totalSections": 3,
    "totalSeats": 5,
    "createdAt": "2026-02-26T10:00:00.000Z",
    "modifiedAt": "2026-02-26T11:00:00.000Z"
  }
}
```

---

## 测试场景

### 场景 1：基础导入导出测试

**步骤**：
1. 在应用中创建一个简单区域
2. 添加几个座位
3. 点击导出按钮
4. 打开下载的 JSON 文件验证格式
5. 删除当前所有数据
6. 点击导入按钮，选择刚才导出的文件
7. 验证数据是否完整恢复

**预期结果**：
- 区域位置、形状、颜色正确
- 座位位置、属性正确
- 校准参数正确

### 场景 2：跨设备数据迁移

**步骤**：
1. 在设备 A 上创建完整场馆
2. 导出数据
3. 通过云盘/邮件传输到设备 B
4. 在设备 B 上导入数据
5. 验证所有数据

**预期结果**：
- 所有区域完整
- 所有座位完整
- 可以继续编辑

### 场景 3：数据备份恢复

**步骤**：
1. 创建场馆数据
2. 导出备份（backup-v1.json）
3. 继续编辑并修改
4. 导出新版本（backup-v2.json）
5. 如需回退，导入 backup-v1.json

**预期结果**：
- 可以恢复到任意备份点
- 数据不丢失

### 场景 4：模板复用

**步骤**：
1. 创建标准剧场模板
2. 导出为 template-theater.json
3. 新项目导入模板
4. 修改座位数量和布局
5. 另存为新文件

**预期结果**：
- 快速创建相似场馆
- 减少重复工作

---

## 数据验证清单

### 导出验证

- [ ] 文件格式为有效的 JSON
- [ ] 包含 version 字段
- [ ] 包含 timestamp 字段
- [ ] 包含 venueName 字段
- [ ] sections 数组不为空
- [ ] metadata 包含正确的统计信息
- [ ] 座位坐标为局部坐标
- [ ] 校准数据完整

### 导入验证

- [ ] 文件格式验证通过
- [ ] 显示确认对话框
- [ ] 区域数量正确
- [ ] 座位数量正确
- [ ] 区域位置正确
- [ ] 座位位置正确
- [ ] 校准参数正确
- [ ] 背景图恢复（如果有）

---

## 常见测试问题

### Q: 导入后座位位置不对？

**检查点**：
1. 座位坐标是否为局部坐标
2. section 原点计算是否正确
3. 坐标转换是否正确

### Q: 导入后背景图不显示？

**检查点**：
1. backgroundImage 字段是否存在
2. 是 Data URL 还是 HTTP URL
3. 网络连接是否正常（HTTP URL）
4. Data URL 格式是否正确

### Q: 导入失败提示格式错误？

**检查点**：
1. JSON 格式是否正确（使用 JSON 验证工具）
2. 必需字段是否完整
3. 数据类型是否正确
4. 文件是否被截断

---

## 调试技巧

### 1. 查看导出数据

```javascript
// 在浏览器控制台执行
console.log(JSON.stringify(sections, null, 2));
```

### 2. 验证 JSON 格式

使用在线工具：
- https://jsonlint.com/
- https://jsonformatter.org/

### 3. 检查数据完整性

```javascript
// 检查座位总数
const totalSeats = sections.reduce((sum, s) => sum + s.seats.length, 0);
console.log('总座位数:', totalSeats);

// 检查校准状态
sections.forEach(s => {
  console.log(`${s.name}: ${s.calibrationData?.isCalibrated ? '已校准' : '未校准'}`);
});
```

### 4. 对比导入导出数据

```javascript
// 导出前
const beforeExport = JSON.stringify(sections);

// 导入后
const afterImport = JSON.stringify(sections);

// 对比
console.log('数据一致:', beforeExport === afterImport);
```

---

## 性能测试

### 大规模数据测试

**测试数据**：
- 10 个区域
- 每个区域 1000 个座位
- 总计 10,000 个座位

**测试指标**：
- 导出时间：< 1 秒
- 文件大小：< 5 MB
- 导入时间：< 2 秒
- 渲染时间：< 3 秒

---

*文档结束*
