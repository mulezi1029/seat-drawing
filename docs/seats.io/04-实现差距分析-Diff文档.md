# Seats.io Designer - 实现差距分析 (Diff 文档)

本文档对比当前项目实现与 seats.io 设计文档的差距，标注已实现(✅)、部分实现(🟡)、未实现(❌)。

---

## 1. 画布模块 (Canvas Module)

### 1.1 画布基础

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 画布初始化 | SVG 画布，初始视口 | SVGCanvas.tsx 实现 | ✅ | 完全实现 |
| 背景网格 | 显示/隐藏，多种样式 | 未实现 | ❌ | 无网格显示功能 |
| 背景图片 | SVG/PNG/JPG 底图 | SVGRenderer 支持 backgroundImage | ✅ | 已实现，支持 URL 设置 |
| 背景颜色 | 纯色背景自定义 | 通过 CSS 设置 | 🟡 | 基础支持，无 UI 调节 |
| 透明度调节 | 背景图透明度 0-100% | 未实现 | ❌ | 无透明度调节 |

### 1.2 坐标系统

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| Screen 坐标 | 屏幕像素坐标 | 实现 | ✅ | clientX/clientY 直接使用 |
| Viewport 坐标 | 容器坐标系 | 实现 | ✅ | getBoundingClientRect 转换 |
| World 坐标 | (-25000~25000) | 实现 | ✅ | useViewport 中完整实现 |
| 坐标转换 | 双向转换 | CoordinateTransform 工具 | ✅ | 三种坐标系完整转换 |
| 网格吸附 | 对齐网格点 | 未实现 | ❌ | 无吸附功能 |

### 1.3 渲染分层

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 背景层 (Layer 0) | 网格、背景图片 | SVG 中 image 元素 | 🟡 | 无网格，背景图有 |
| 区域层 (Layer 1) | Section 多边形 | polygon 元素 | ✅ | 完整实现 |
| 座位层 (Layer 2) | Seat 图形 | g > circle + text | ✅ | 完整实现 |
| 标注层 (Layer 3) | 文字标签、图标 | 未实现 | ❌ | 无标注功能 |
| 交互层 (Layer 4) | 选中框、拖拽预览 | OverlayRenderer | ✅ | 完整实现 |

**Diff 详情：**
```diff
设计期望：
+ 网格显示 (Ctrl+G 切换)
+ 网格密度选择 (10px/20px/50px/100px)
+ 网格样式切换 (点状/线状/十字状)
+ 对齐模式 (自由绘制/强制对齐)

当前实现：
- 无任何网格功能
- 无吸附功能
- 仅支持背景图片透明度调节 (缺失)
```

---

## 2. 区域模块 (Section Module)

### 2.1 区域创建

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 多边形绘制 | 点击添加顶点 | DrawSectionTool 实现 | ✅ | 完整实现 |
| 矩形绘制 | 拖拽创建矩形 | Shift 键矩形模式 | ✅ | 已实现 |
| 圆形绘制 | 拖拽创建圆形 | 未实现 | ❌ | 无圆形区域工具 |
| 自动闭合 | 双击/Enter/点击起点 | 双击闭合 | 🟡 | 缺少 Enter 和点击起点闭合 |
| 最小顶点数限制 | 至少3个顶点 | 未实现 | ❌ | 无验证逻辑 |
| 自交检测 | 防止自交多边形 | 未实现 | ❌ | 无自交检测 |

### 2.2 区域编辑

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 顶点编辑 | 拖动顶点调整 | 未实现 | ❌ | 无法编辑顶点位置 |
| 添加顶点 | 边上点击添加 | 未实现 | ❌ | 无顶点编辑功能 |
| 删除顶点 | 删除多余顶点 | 未实现 | ❌ | 无顶点编辑功能 |
| 形状闭合 | 重新编辑已闭合区域 | 未实现 | ❌ | 无法修改已创建区域形状 |
| 区域移动 | 整体拖拽移动 | ✅ ViewTool 实现 | ✅ | 完整实现 |
| 实时预览 | 绘制时显示预览 | ✅ 实现 | ✅ | 实时边线预览 |

### 2.3 区域属性

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 名称设置 | 区域显示名称 | SectionPanel 中编辑 | ✅ | 已实现 |
| 类别绑定 | 关联座位类别 | 未实现 | ❌ | 无类别系统 |
| 颜色设置 | 填充/边框颜色 | color picker 实现 | ✅ | 完整实现 |
| 透明度 | 填充透明度 | opacity slider | ✅ | 0-1 范围调节 |
| 容量统计 | 显示座位数量 | 显示统计 | ✅ | 已实现 |

### 2.4 区域管理

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 删除区域 | 删除区域及座位 | ✅ 实现 | ✅ | 完整实现 |
| 复制区域 | 复制区域及座位 | 未实现 | ❌ | 无复制功能 |
| 区域层级 | 调整渲染顺序 | 未实现 | ❌ | 无层级调整 |
| 显示/隐藏 | 切换可见性 | 未实现 | ❌ | 无显示切换 |
| 锁定区域 | 防止误操作 | 未实现 | ❌ | 无锁定功能 |

### 2.5 Focus Mode

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 进入编辑 | 双击进入 | ✅ 实现 | ✅ | 双击进入 section-edit 模式 |
| 自动校准 | 自动缩放适应 | ✅ 实现 | ✅ | enterSection 中自动计算 |
| 淡化其他 | 其他区域透明度 | ✅ 实现 | ✅ | opacity 0.3 |
| 退出恢复 | 恢复原始视图 | ✅ 实现 | ✅ | previousViewportRef 保存恢复 |
| 独立编辑 | 仅编辑当前区域 | ✅ 实现 | ✅ | selectedSectionId 控制 |

**Diff 详情：**
```diff
设计期望：
+ 圆形区域绘制工具
+ 顶点编辑模式 (双击顶点或"编辑形状"按钮)
+ 边上添加/删除顶点
+ 区域复制功能
+ 图层顺序调整
+ 区域显示/隐藏切换
+ 区域锁定功能

当前实现：
- 仅支持多边形和矩形 (Shift)
- 创建后无法修改形状
- 无区域层级管理
- Focus Mode 已完整实现
```

---

## 3. 座位模块 (Seat Module)

### 3.1 座位创建

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 单个添加 | 点击放置 | ✅ DrawSeatTool | ✅ | 完整实现 |
| 行添加 | 拖拽创建行 | ✅ 实现 | ✅ | 方向 + 间距设置 |
| 曲线排布 | 沿曲线创建 | 未实现 | ❌ | 无曲线工具 |
| 表格添加 | 矩形网格批量 | 未实现 | ❌ | 无表格工具 |
| 数量预览 | 显示创建数量 | ✅ 实时计算 | ✅ | 拖拽时显示数量 |
| 方向调整 | 调整行方向 | ✅ 实现 | ✅ | 鼠标位置决定方向 |

### 3.2 座位编辑

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 拖拽移动 | 移动单个/多个 | ✅ SelectTool | ✅ | 完整实现 |
| 旋转 | 旋转座位方向 | 未实现 | ❌ | 无旋转功能 |
| 镜像 | 水平/垂直翻转 | 未实现 | ❌ | 无镜像功能 |
| 对齐 | 8 方向对齐 | ✅ AlignSeatsCommand | ✅ | 8 种对齐方式 |
| 分布 | 均匀分布 | ✅ distribute-h/v | ✅ | 已实现 |

### 3.3 座位属性

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 排号设置 | 设置排号 | ✅ PropertiesPanel | ✅ | 完整实现 |
| 座位号设置 | 设置编号 | ✅ 实现 | ✅ | 完整实现 |
| 类别设置 | 关联类别 | 未实现 | ❌ | 无类别系统 |
| 状态设置 | 可用/已售/锁定 | ✅ status select | ✅ | 三种状态 |
| 特殊标记 | 无障碍/VIP | 未实现 | ❌ | 无特殊标记 |

### 3.4 座位管理

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 删除座位 | 删除选中 | ✅ DeleteSeatCommand | ✅ | 完整实现 |
| 批量删除 | 删除多个 | ✅ DeleteSeatsCommand | ✅ | 支持 |
| 复制座位 | 复制选中 | 未实现 | ❌ | 无复制功能 |
| 智能编号 | 自动编号 | 未实现 | ❌ | 无自动编号 |
| 编号预览 | 显示编号预览 | ✅ 实时显示 | ✅ | 缩放足够大时显示 |

### 3.5 座位检测

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 重叠检测 | 检测座位重叠 | 未实现 | ❌ | 无重叠检测 |
| 间距警告 | 过于接近警告 | 未实现 | ❌ | 无间距检查 |
| 区域归属 | 判断所属区域 | ✅ 自动归属 | ✅ | sectionId 关联 |
| 位置校验 | 确保在区域内 | 未实现 | ❌ | 无边界校验 |

**Diff 详情：**
```diff
设计期望：
+ 曲线排布工具 (B 键)
+ 表格添加工具 (T 键)
+ 座位旋转功能
+ 座位镜像功能
+ 座位类别系统
+ 特殊座位标记 (无障碍、VIP)
+ 智能自动编号
+ 座位重叠检测
+ 最小间距警告

当前实现：
- 仅支持单个和行添加
- 无曲线或表格工具
- 无旋转/镜像
- 类别系统缺失
- 无重叠检测
```

---

## 4. 工具系统 (Tool System)

### 4.1 工具基础架构

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 工具基类 | Tool 接口 | ✅ BaseTool | ✅ | 完整接口定义 |
| 工具管理器 | 注册/切换/管理 | ✅ ToolManager | ✅ | 完整实现 |
| 事件分发 | 鼠标/键盘分发 | ✅ 实现 | ✅ | 完整事件路由 |
| 状态管理 | 状态保存恢复 | 🟡 基础支持 | 🟡 | activate/deactivate 有定义 |
| 光标切换 | 工具切换光标 | ✅ 实现 | ✅ | cursor 属性 |

### 4.2 选择工具 (ViewTool)

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 画布平移 | Space/中键拖拽 | ✅ 实现 | ✅ | Space+drag, 中键 |
| 画布缩放 | 滚轮缩放 | ✅ 实现 | ✅ | onWheel |
| 对象选择 | 点击选中 | ✅ 实现 | ✅ | handleSelect |
| 多选支持 | Shift+点击 | ✅ 实现 | ✅ | shiftKey 判断 |
| 双击进入 | 双击进入编辑 | ✅ 实现 | ✅ | onDoubleClick |

### 4.3 区域绘制工具 (DrawSectionTool)

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 顶点创建 | 点击创建 | ✅ 实现 | ✅ | 完整实现 |
| 实时预览 | 显示绘制边 | ✅ 实现 | ✅ | 实时边线 |
| 闭合提示 | 靠近起点高亮 | 🟡 有距离判断 | 🟡 | 无视觉高亮 |
| 闭合方式 | 双击/Enter/点击起点 | 仅双击 | 🟡 | 缺少 Enter 和点击闭合 |
| 取消绘制 | Esc 取消 | ✅ 实现 | ✅ | onKeyDown 处理 |
| 网格吸附 | 吸附网格点 | 未实现 | ❌ | 无吸附 |

### 4.4 座位绘制工具 (DrawSeatTool)

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 单点模式 | 逐个放置 | ✅ 实现 | ✅ | 完整实现 |
| 行模式 | 拖拽创建行 | ✅ 实现 | ✅ | 完整实现 |
| 曲线模式 | 沿曲线放置 | 未实现 | ❌ | 无曲线模式 |
| 实时预览 | 显示预览位置 | ✅ 实现 | ✅ | 座位预览 |
| 间距设置 | 调整间距 | ✅ 实现 | ✅ | spacing 参数 |
| 方向调整 | 调整朝向 | ✅ 实现 | ✅ | 鼠标跟随 |

### 4.5 其他工具

| 工具 | 设计文档 | 当前实现 | 状态 |
|------|----------|----------|------|
| 测量工具 | 测量距离 | 未实现 | ❌ |
| 文本标注 | 文字标签 | 未实现 | ❌ |
| 设施标记 | 出入口/卫生间 | 未实现 | ❌ |
| 套索选择 | 自由绘制选择 | 未实现 | ❌ |

**Diff 详情：**
```diff
设计期望：
+ 测量工具 (测量距离)
+ 文本标注工具 (X 键)
+ 设施标记工具 (I 键)
+ 套索选择工具 (Alt+drag)
+ Enter 键闭合多边形
+ 点击起点闭合多边形

当前实现：
- ViewTool, DrawSectionTool, DrawSeatTool, SelectTool, MoveTool
- 仅双击闭合
- 无测量、文本、设施标记工具
```

---

## 5. 视图模块 (Viewport Module)

### 5.1 视口变换

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 缩放控制 | 10%-500% | ✅ 实现 | ✅ | min 0.1, max 5 |
| 平移控制 | 画布移动 | ✅ 实现 | ✅ | offsetX/Y |
| 中心缩放 | 鼠标位置中心 | ✅ 实现 | ✅ | onWheel 中计算 |
| 平滑缩放 | 动画过渡 | 未实现 | ❌ | 无动画 |

### 5.2 视图预设

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 100% 视图 | 还原比例 | ✅ fit 按钮 | ✅ | 快捷键 F |
| 适应屏幕 | 缩放到适应 | ✅ 实现 | ✅ | zoomToFit |
| 适应宽度 | 适应宽度 | 未实现 | ❌ | 无单独功能 |
| 适应选中 | 缩放到选中 | 未实现 | ❌ | 无此功能 |
| 保存视图 | 保存状态 | ✅ 实现 | ✅ | previousViewportRef |

### 5.3 视口计算

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 边界计算 | 计算边界框 | ✅ Geometry | ✅ | getBoundingBox |
| 自动校准 | 缩放到区域 | ✅ enterSection | ✅ | 完整实现 |
| 状态保存 | 保存/恢复 | ✅ 实现 | ✅ | Ref 保存 |
| 转换矩阵 | SVG transform | ✅ 实现 | ✅ | matrix 计算 |

**Diff 详情：**
```diff
设计期望：
+ 平滑缩放动画
+ 适应宽度功能
+ 适应选中对象
+ 多个视图状态保存

当前实现：
- 瞬时缩放，无动画
- 仅适应屏幕 (fit)
- 保存一个视图状态 (用于 exit section)
```

---

## 6. 选择模块 (Selection Module)

### 6.1 选择基础

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 单选 | 点击选中 | ✅ 实现 | ✅ | 完整实现 |
| 加选 | Shift+点击 | ✅ 实现 | ✅ | toggle 逻辑 |
| 减选 | Shift+点击已选中 | ✅ 实现 | ✅ | toggle 逻辑 |
| 全选 | Ctrl+A | ✅ 实现 | ✅ | selectAllSeats |
| 取消选择 | Esc/点击空白 | ✅ 实现 | ✅ | clearSelection |

### 6.2 框选功能

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 矩形框选 | 拖拽矩形选择 | ✅ SelectTool | ✅ | 实现 |
| 交叉选择 | 接触即选中 | 🟡 默认行为 | 🟡 | 无明确切换 |
| 包含选择 | 完全包含选中 | 未实现 | ❌ | 无此选项 |
| 套索选择 | 自由绘制选择 | 未实现 | ❌ | 无套索工具 |

### 6.3 选择管理

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 选择集 | Set 管理 | ✅ useSelection | ✅ | Set<string> |
| 类型过滤 | 按类型过滤 | 未实现 | ❌ | 无过滤功能 |
| 反选 | 反选当前 | 未实现 | ❌ | 无反选 |
| 选择历史 | 保存历史 | 未实现 | ❌ | 无历史 |

### 6.4 选择可视化

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 选中框 | 对象选中边框 | ✅ OverlayRenderer | ✅ | 蓝色边框 |
| 高亮效果 | 选中高亮 | ✅ 实现 | ✅ | stroke 高亮 |
| 统计信息 | 显示数量 | ✅ 实现 | ✅ | 底部状态栏显示 |

**Diff 详情：**
```diff
设计期望：
+ 交叉选择 vs 包含选择 切换
+ 套索选择 (Alt+拖拽)
+ 按类型过滤选择
+ 反选功能
+ 选择历史

当前实现：
- 仅矩形框选
- 无套索工具
- 无过滤/反选/历史
```

---

## 7. 命令系统 (Command System)

### 7.1 命令基础

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 命令接口 | Command 规范 | ✅ 定义 | ✅ | 完整接口 |
| 执行方法 | execute() | ✅ 实现 | ✅ | 所有命令 |
| 撤销方法 | undo() | ✅ 实现 | ✅ | 所有命令 |
| 重做方法 | redo() | ✅ 实现 | ✅ | 默认调用 execute |
| 命令描述 | 历史记录描述 | ✅ description | ✅ | 已实现 |

### 7.2 命令管理器

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 历史栈 | 维护历史 | ✅ 实现 | ✅ | history 数组 |
| 执行命令 | 执行并记录 | ✅ execute | ✅ | 完整实现 |
| 撤销操作 | 撤销最近 | ✅ undo | ✅ | 完整实现 |
| 重做操作 | 重做已撤销 | ✅ redo | ✅ | 完整实现 |
| 历史限制 | 最大数量 | ✅ maxHistory=50 | ✅ | 已实现 |
| 清空历史 | 清空命令 | 未实现 | ❌ | 无清空功能 |

### 7.3 具体命令

| 命令 | 设计文档 | 当前实现 | 状态 |
|------|----------|----------|------|
| CreateSectionCommand | 创建区域 | ✅ 实现 | ✅ |
| DeleteSectionCommand | 删除区域 | ✅ 实现 | ✅ |
| MoveSectionCommand | 移动区域 | ✅ 实现 | ✅ |
| UpdateSectionCommand | 更新属性 | ✅ 实现 | ✅ |
| CreateSeatCommand | 创建座位 | ✅ 实现 | ✅ |
| DeleteSeatCommand | 删除座位 | ✅ 实现 | ✅ |
| MoveSeatsCommand | 移动座位 | ✅ 实现 | ✅ |
| UpdateSeatCommand | 更新座位 | ✅ 实现 | ✅ |
| AlignSeatsCommand | 对齐座位 | ✅ 实现 | ✅ |
| BatchCommand | 批量组合 | 未实现 | ❌ |

**Diff 详情：**
```diff
设计期望：
+ 清空历史功能
+ 批量命令组合 (用于复杂操作)
+ 命令历史面板 UI

当前实现：
- 核心命令完整
- 无批量命令
- 无历史面板
```

---

## 8. 属性面板模块 (Properties Panel Module)

### 8.1 区域属性面板

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 名称编辑 | 修改名称 | ✅ 实现 | ✅ | input 绑定 |
| 类别选择 | 选择类别 | 未实现 | ❌ | 无类别系统 |
| 颜色选择 | 填充/边框 | ✅ color picker | ✅ | 完整实现 |
| 透明度滑块 | 调整透明度 | ✅ slider | ✅ | 0-1 范围 |
| 容量显示 | 座位数量 | ✅ 显示 | ✅ | 统计计算 |
| 编辑形状 | 进入形状编辑 | 未实现 | ❌ | 无形状编辑 |
| 删除按钮 | 删除区域 | ✅ 实现 | ✅ | 完整实现 |

### 8.2 座位属性面板

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 排号编辑 | 修改排号 | ✅ 实现 | ✅ | 完整实现 |
| 座位号编辑 | 修改编号 | ✅ 实现 | ✅ | 完整实现 |
| 类别选择 | 选择类别 | 未实现 | ❌ | 无类别 |
| 状态选择 | 选择状态 | ✅ select | ✅ | 三种状态 |
| 批量编辑 | 批量修改 | 🟡 部分 | 🟡 | 只能改状态 |
| 删除按钮 | 删除座位 | ✅ 实现 | ✅ | 完整实现 |

### 8.3 多选属性面板

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 对齐按钮 | 8 方向对齐 | ✅ Toolbar | ✅ | 已实现 |
| 分布按钮 | 均分 | ✅ Toolbar | ✅ | 已实现 |
| 统一类别 | 批量设置 | 未实现 | ❌ | 无类别 |
| 统一颜色 | 批量设置 | 未实现 | ❌ | 无批量颜色 |
| 删除全部 | 删除选中 | ✅ 实现 | ✅ | 完整实现 |

**Diff 详情：**
```diff
设计期望：
+ 类别选择下拉框
+ 形状编辑按钮 (进入顶点编辑)
+ 多选时统一设置颜色
+ 更多批量操作

当前实现：
- 基础属性编辑完整
- 无类别系统
- 无形状编辑
- 对齐/分布在 Toolbar 而非 PropertiesPanel
```

---

## 9. 图层面板模块 (Layers Panel Module)

### 9.1 图层列表

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 图层树 | 显示区域座位 | 🟡 SectionPanel | 🟡 | 仅区域列表，无座位 |
| 嵌套显示 | 区域下显示座位 | 未实现 | ❌ | 无嵌套 |
| 数量统计 | 显示数量 | ✅ 实现 | ✅ | 显示座位数 |
| 选中同步 | 与画布同步 | ✅ 实现 | ✅ | 双向同步 |

### 9.2 图层操作

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| 可见性切换 | 显示/隐藏 | 未实现 | ❌ | 无此功能 |
| 锁定切换 | 锁定/解锁 | 未实现 | ❌ | 无此功能 |
| 拖拽排序 | 调整顺序 | 未实现 | ❌ | 无拖拽 |
| 重命名 | 修改名称 | ✅ 实现 | ✅ | 可编辑 |
| 删除 | 删除图层 | ✅ 实现 | ✅ | 删除按钮 |

### 9.3 快捷操作

| 功能点 | 设计文档 | 当前实现 | 状态 |
|--------|----------|----------|------|
| 展开/收起 | 展开子项 | 未实现 | ❌ |
| 全部显示 | 显示所有 | 未实现 | ❌ |
| 全部隐藏 | 隐藏所有 | 未实现 | ❌ |
| 全部锁定 | 锁定所有 | 未实现 | ❌ |
| 全部解锁 | 解锁所有 | 未实现 | ❌ |

**Diff 详情：**
```diff
设计期望：
+ 完整图层树 (区域可展开显示座位)
+ 眼睛图标 (显示/隐藏)
+ 锁图标 (锁定/解锁)
+ 拖拽调整图层顺序
+ 全部显示/隐藏/锁定/解锁按钮

当前实现：
- SectionPanel 仅列出区域
- 无座位嵌套显示
- 无可见性/锁定控制
- 无拖拽排序
```

---

## 10. 类别管理模块 (Category Module)

### 10.1 类别基础

| 功能点 | 设计文档 | 当前实现 | 状态 |
|--------|----------|----------|------|
| 类别列表 | 显示类别 | 未实现 | ❌ |
| 颜色编码 | 关联颜色 | 未实现 | ❌ |
| 定价设置 | 设置价格 | 未实现 | ❌ |
| 图标选择 | 选择图标 | 未实现 | ❌ |

### 10.2 类别操作

| 功能点 | 设计文档 | 当前实现 | 状态 |
|--------|----------|----------|------|
| 添加类别 | 创建类别 | 未实现 | ❌ |
| 编辑类别 | 修改信息 | 未实现 | ❌ |
| 删除类别 | 删除类别 | 未实现 | ❌ |
| 类别排序 | 调整顺序 | 未实现 | ❌ |

### 10.3 类别应用

| 功能点 | 设计文档 | 当前实现 | 状态 |
|--------|----------|----------|------|
| 应用到区域 | 区域关联 | 未实现 | ❌ |
| 应用到座位 | 座位关联 | 未实现 | ❌ |
| 批量应用 | 批量设置 | 未实现 | ❌ |

**Diff 详情：**
```diff
设计期望：
+ 完整的类别管理系统
+ 每个类别: 名称、颜色、价格、图标
+ 区域/座位可关联类别
+ 类别面板 UI

当前实现：
- 完全缺失类别系统
- 座位只有 status (available/occupied/disabled)
```

---

## 11. 导入导出模块 (Import/Export Module)

### 11.1 导入功能

| 功能点 | 设计文档 | 当前实现 | 状态 | 差距说明 |
|--------|----------|----------|------|----------|
| SVG 导入 | 导入背景 | ✅ UploadSvgCommand | ✅ | 完整实现 |
| 图片导入 | PNG/JPG 背景 | 🟡 可能支持 | 🟡 | 未测试 |
| CAD 导入 | CAD 文件 | 未实现 | ❌ | 无此功能 |
| 数据导入 | JSON 数据 | ✅ ImportDataCommand | ✅ | 完整实现 |

### 11.2 导出功能

| 功能点 | 设计文档 | 当前实现 | 状态 |
|--------|----------|----------|------|
| SVG 导出 | SVG 文件 | 未实现 | ❌ |
| PNG 导出 | PNG 图片 | 未实现 | ❌ |
| PDF 导出 | PDF | 未实现 | ❌ |
| JSON 导出 | JSON 数据 | ✅ ExportDataCommand | ✅ |

### 11.3 保存加载

| 功能点 | 设计文档 | 当前实现 | 状态 |
|--------|----------|----------|------|
| 自动保存 | 定时保存 | 未实现 | ❌ |
| 手动保存 | Ctrl+S | 未实现 | ❌ |
| 项目加载 | 加载项目 | 未实现 | ❌ |
| 版本管理 | 历史版本 | 未实现 | ❌ |

**Diff 详情：**
```diff
设计期望：
+ PNG/PDF 导出
+ 自动保存机制
+ 项目管理 (保存/加载多个项目)
+ 版本历史

当前实现：
- JSON 导入/导出 (数据)
- SVG 背景导入
- 无图片/PDF 导出
- 无自动保存
```

---

## 12. 快捷键模块 (Shortcut Module)

### 12.1 全局快捷键

| 快捷键 | 设计文档 | 当前实现 | 状态 |
|--------|----------|----------|------|
| Ctrl+Z | 撤销 | ✅ 实现 | ✅ |
| Ctrl+Shift+Z / Ctrl+Y | 重做 | ✅ 实现 | ✅ |
| Ctrl+S | 保存 | 未实现 | ❌ |
| Ctrl+A | 全选 | ✅ 实现 | ✅ |
| Delete/Backspace | 删除选中 | ✅ 实现 | ✅ |
| Esc | 取消/清空 | ✅ 实现 | ✅ |

### 12.2 工具快捷键

| 快捷键 | 功能 | 当前实现 | 状态 |
|--------|------|----------|------|
| V | 选择工具 | ✅ 实现 | ✅ |
| S | 区域绘制 | ✅ 实现 | ✅ |
| P | 单个座位 | ✅ 实现 | ✅ |
| L | 行添加 | ✅ 实现 | ✅ |
| T | 表格添加 | 未实现 | ❌ |
| B | 曲线排布 | 未实现 | ❌ |
| X | 文本标注 | 未实现 | ❌ |

### 12.3 视图快捷键

| 快捷键 | 功能 | 当前实现 | 状态 |
|--------|------|----------|------|
| Ctrl+G | 显示/隐藏网格 | 未实现 | ❌ |
| Ctrl+R | 显示/隐藏标尺 | 未实现 | ❌ |
| Ctrl+Plus | 放大 | 未实现 | ❌ |
| Ctrl+Minus | 缩小 | 未实现 | ❌ |
| Ctrl+0 | 100% 视图 | 未实现 | ❌ |
| Ctrl+1 | 适应屏幕 | ✅ (F 键) | 🟡 |
| Space+Drag | 抓手工具 | ✅ 实现 | ✅ |

### 12.4 编辑快捷键

| 快捷键 | 功能 | 当前实现 | 状态 |
|--------|------|----------|------|
| 方向键 | 微调 (1px) | 未实现 | ❌ |
| Shift+方向键 | 微调 (10px) | 未实现 | ❌ |
| Ctrl+C | 复制 | 未实现 | ❌ |
| Ctrl+V | 粘贴 | 未实现 | ❌ |
| Ctrl+X | 剪切 | 未实现 | ❌ |

**Diff 详情：**
```diff
设计期望：
+ Ctrl+S 保存
+ T/B/X 工具快捷键
+ Ctrl+G/R 显示切换
+ Ctrl+Plus/Minus/0 缩放
+ 方向键微调
+ Ctrl+C/V/X 复制粘贴

当前实现：
- V/S/P/L 工具键
- F 适应屏幕 (非 Ctrl+1)
- Space 抓手
- 无网格/标尺切换
- 无方向键微调
- 无复制粘贴
```

---

## 13. UI 组件差距

### 13.1 顶部导航栏

| 组件 | 设计文档 | 当前实现 | 状态 |
|------|----------|----------|------|
| Logo/品牌 | 返回主页 | 未实现 | ❌ |
| 项目名称 | 可编辑名称 | 未实现 | ❌ |
| 保存状态 | 自动保存指示 | 未实现 | ❌ |
| 视图切换 | Design/Preview/Code | 未实现 | ❌ |
| 撤销/重做按钮 | 按钮 + 快捷键提示 | 未实现 | ❌ |
| 预览按钮 | 新窗口预览 | 未实现 | ❌ |
| 发布按钮 | 版本管理 | 未实现 | ❌ |

### 13.2 底部状态栏

| 组件 | 设计文档 | 当前实现 | 状态 | 差距 |
|------|----------|----------|------|------|
| 缩放滑块 | [-] [===●===] [+] | ✅ 实现 | ✅ | 完整 |
| 缩放预设 | 100%、适应屏幕 | 🟡 部分 | 🟡 | 仅适应 |
| 坐标显示 | X: 123 Y: 456 | ✅ 实现 | ✅ | 完整 |
| 选中统计 | 已选: 12个 | ✅ 实现 | ✅ | 完整 |
| 总计统计 | 总计: 450个 | ✅ 实现 | ✅ | 完整 |
| 帮助链接 | [?] 帮助中心 | 未实现 | ❌ | 缺失 |
| 快捷键列表 | [⌨️] 快捷键 | 未实现 | ❌ | 缺失 |
| 画布设置 | [⚙️] 设置 | 未实现 | ❌ | 缺失 |

### 13.3 右侧面板

| 面板 | 设计文档 | 当前实现 | 状态 |
|------|----------|----------|------|
| 属性面板 | 动态内容 | ✅ PropertiesPanel | ✅ |
| 图层面板 | 图层树 | 🟡 SectionPanel | 🟡 |
| 类别面板 | 类别管理 | 未实现 | ❌ |
| 设置面板 | 画布设置 | 未实现 | ❌ |

**当前 UI 结构：**
```
已实现：
┌─────────┬──────────────┬─────────┐
│ Toolbar │    Canvas    │ Section │
│ (左侧)  │   (中央)     │ Panel   │
│         │              │ (右侧)  │
├─────────┴──────────────┴─────────┤
│      Bottom Status Bar           │
└──────────────────────────────────┘

设计期望：
┌──────────────────────────────────┐
│      Top Navigation Bar          │
├─────────┬──────────────┬─────────┤
│ Toolbar │    Canvas    │Properties│
│ (左侧)  │   (中央)     │Layers   │
│         │              │Categories│
├─────────┴──────────────┴─────────┤
│      Bottom Status Bar           │
└──────────────────────────────────┘
```

---

## 14. 架构差距总结

### 14.1 已实现架构 (✅)

1. **Tool System** - 完整的工具架构
   - ToolManager 统一管理
   - BaseTool 基类定义
   - 5 个工具实现

2. **Command Pattern** - 完整的命令系统
   - CommandManager 历史管理
   - 12+ 命令实现
   - Undo/Redo 完整支持

3. **Scene Graph** - 空间数据结构
   - Spatial Index (网格索引)
   - O(1) 查询性能
   - Hit testing

4. **Coordinate System** - 三层坐标系
   - Screen/Viewport/World
   - 完整转换工具

5. **SVG Rendering** - 渲染层
   - Flat SVG 架构
   - 单一 viewport transform
   - OverlayRenderer

### 14.2 缺失架构 (❌)

1. **组件化 UI 架构**
   - 缺少顶部导航栏
   - 缺少图层面板
   - 缺少类别管理面板

2. **状态持久化**
   - 无本地存储
   - 无自动保存
   - 无项目管理

3. **事件系统**
   - 无全局事件总线
   - 组件间通信通过 props

4. **测试架构**
   - 无单元测试
   - 无集成测试
   - 无 E2E 测试

### 14.3 技术债务

1. **useVenueDesigner.ts vs useVenueDesignerNew.ts**
   - 两个版本并存，需清理

2. **ToolManager 事件路由**
   - 当前遍历所有工具
   - 可优化为直接路由

3. **大数量座位渲染**
   - 无虚拟化
   - 1000+ 座位可能卡顿

---

## 15. 实现优先级建议

### P0 - 核心功能 (必须实现)

| 功能 | 影响 | 工作量 |
|------|------|--------|
| 网格显示与吸附 | 绘制精度 | 中等 |
| Enter/点击起点闭合 | 绘制体验 | 小 |
| 类别管理系统 | 座位管理 | 大 |
| 复制/粘贴功能 | 编辑效率 | 中等 |

### P1 - 重要功能 (建议实现)

| 功能 | 影响 | 工作量 |
|------|------|--------|
| 顶点编辑模式 | 区域修改 | 大 |
| 图层树面板 | 对象管理 | 中等 |
| PNG/PDF 导出 | 交付物 | 中等 |
| 自动保存 | 数据安全 | 小 |
| 方向键微调 | 精细调整 | 小 |

### P2 - 一般功能 (可选实现)

| 功能 | 影响 | 工作量 |
|------|------|--------|
| 曲线排布工具 | 剧场座位 | 大 |
| 表格添加工具 | 餐厅座位 | 中等 |
| 文本标注工具 | 标注说明 | 中等 |
| 测量工具 | 精确测量 | 中等 |
| 套索选择 | 灵活选择 | 中等 |

### P3 - 增强功能 (低优先级)

| 功能 | 影响 | 工作量 |
|------|------|--------|
| 圆形区域 | 特殊场地 | 中等 |
| 座位旋转 | 方向调整 | 中等 |
| 座位镜像 | 对称布局 | 中等 |
| 3D 预览 | 展示效果 | 大 |
| 实时协作 | 团队协作 | 大 |

---

## 16. 代码示例：典型差距

### 差距 1：网格系统

```typescript
// 设计期望
interface GridOptions {
  visible: boolean;
  size: 10 | 20 | 50 | 100;
  style: 'dot' | 'line' | 'cross';
  snap: boolean;
}

// 当前实现：完全缺失
// 需要添加到 ViewportState 和渲染层
```

### 差距 2：类别系统

```typescript
// 设计期望
interface Category {
  id: string;
  name: string;
  color: string;
  price: number;
  icon?: string;
}

interface Seat {
  id: string;
  categoryId: string;  // 关联类别
  // ...
}

// 当前实现：无 Category 类型
// Seat 只有 status: 'available' | 'occupied' | 'disabled'
```

### 差距 3：图层管理

```typescript
// 设计期望
interface Layer {
  id: string;
  name: string;
  type: 'section' | 'seat' | 'annotation';
  visible: boolean;
  locked: boolean;
  children?: Layer[];
  order: number;
}

// 当前实现：只有 sections 数组
// 无可见性、锁定、排序控制
```

---

## 附录：完成度统计

| 模块 | 设计功能数 | 已实现 | 部分实现 | 未实现 | 完成度 |
|------|-----------|--------|----------|--------|--------|
| 画布模块 | 10 | 5 | 2 | 3 | 60% |
| 区域模块 | 25 | 12 | 3 | 10 | 54% |
| 座位模块 | 25 | 12 | 2 | 11 | 52% |
| 工具系统 | 20 | 12 | 3 | 5 | 67% |
| 视图模块 | 15 | 10 | 1 | 4 | 70% |
| 选择模块 | 15 | 8 | 2 | 5 | 60% |
| 命令系统 | 15 | 13 | 0 | 2 | 90% |
| 属性面板 | 15 | 9 | 2 | 4 | 67% |
| 图层面板 | 12 | 2 | 1 | 9 | 21% |
| 类别管理 | 10 | 0 | 0 | 10 | 0% |
| 导入导出 | 12 | 3 | 1 | 8 | 29% |
| 快捷键 | 20 | 10 | 1 | 9 | 53% |
| **总计** | **194** | **96** | **18** | **80** | **55%** |

**整体完成度：约 55%**

核心架构 (Tool/Command/SceneGraph/Coordinate)：✅ 90%
基础功能 (绘制/选择/移动)：✅ 75%
高级功能 (类别/图层/导出)：❌ 30%
