# 座位交互行为说明

## 📋 概述

本文档详细说明座位选择和拖拽的交互行为，确保用户体验的一致性和可预测性。

## 🎯 核心原则

### 原则 1：先选择，后操作
```
选择座位 → 显示蓝色边框 → 才能拖拽移动
```

### 原则 2：以组为单位
```
所有选择和操作都以绘制的组为单位进行
```

### 原则 3：避免意外操作
```
单击不触发拖拽，防止意外移动座位
```

## 🖱️ 鼠标交互详解

### 1. 单击座位（未选中）

**操作**：单击未选中的座位

**行为**：
```
mouseDown → 不触发拖拽
    ↓
click → 选中整组座位
    ↓
显示蓝色边框
```

**结果**：
- ✅ 整组座位被选中
- ✅ 座位不会移动
- ✅ 显示蓝色边框

**代码逻辑**：
```typescript
handleSeatMouseDown(seatId) {
  // 检查：座位是否已选中？
  if (!selectedSeatIds.has(seatId)) {
    // 未选中 → 不触发拖拽
    return;
  }
  // 已选中 → 开始拖拽
}

handleSeatClick(seatId) {
  // 选中整组
  const expandedIds = expandToGroups([seatId]);
  onSelectSeats(expandedIds);
}
```

### 2. 单击座位（已选中）

**操作**：单击已选中的座位

**行为**：
```
mouseDown → 不触发新选择
    ↓
click → 保持当前选择
```

**结果**：
- ✅ 保持当前选择状态
- ✅ 不会取消选择

### 3. 拖拽座位（已选中）

**操作**：按住已选中的座位并拖拽

**行为**：
```
mouseDown → 检查：已选中？
    ↓ Yes
开始拖拽
    ↓
mouseMove → 实时预览（半透明）
    ↓
mouseUp → 完成移动
```

**结果**：
- ✅ 整组座位一起移动
- ✅ 实时预览半透明效果
- ✅ 释放鼠标完成移动

**代码逻辑**：
```typescript
handleSeatMouseDown(seatId) {
  // 只有已选中的座位才能拖拽
  if (selectedSeatIds.has(seatId)) {
    setDraggingSeatIds(Array.from(selectedSeatIds));
    setDragStartWorld(worldPos);
  }
}
```

### 4. Ctrl+单击座位

**操作**：按住 Ctrl 键单击座位

**行为**：
```
mouseDown → 不触发拖拽
    ↓
click → 切换整组的选中状态
    ↓
如果组已选中 → 取消选中整组
如果组未选中 → 选中整组
```

**结果**：
- ✅ 切换整组状态
- ✅ 支持多组选择
- ✅ 不触发拖拽

### 5. 框选座位

**操作**：拖拽矩形框选择座位

**行为**：
```
mouseDown（空白处）→ 开始框选
    ↓
mouseMove → 显示蓝色虚线框
    ↓
mouseUp → 找到框内座位 → 扩展为完整组
```

**结果**：
- ✅ 选中所有涉及的完整组
- ✅ 即使只框选到部分座位

## 🔄 完整交互流程

### 流程 1：选择并移动座位组

```
步骤 1：选择
  单击座位 → 整组被选中 → 显示蓝色边框

步骤 2：移动
  按住已选中的座位 → 拖拽 → 半透明预览 → 释放 → 完成移动
```

### 流程 2：多组选择

```
步骤 1：选择第一组
  单击第 1 排 → 第 1 组被选中

步骤 2：添加第二组
  Ctrl+单击第 2 排 → 第 2 组被添加

步骤 3：移动所有选中组
  按住任意选中座位 → 拖拽 → 所有组一起移动
```

### 流程 3：框选多组

```
步骤 1：框选
  拖拽框选覆盖 3 排的部分区域

步骤 2：自动扩展
  系统自动扩展为完整的 3 组

步骤 3：批量操作
  拖拽移动 / 删除 / 修改属性
```

## ⚠️ 注意事项

### 1. 拖拽前必须先选中

**错误操作**：
```
❌ 直接单击并拖拽未选中的座位
   → 不会触发拖拽
   → 只会选中座位
```

**正确操作**：
```
✅ 第一次单击 → 选中座位
✅ 第二次按住 → 拖拽移动
```

### 2. 单击和拖拽的区别

| 操作 | 触发条件 | 结果 |
|------|---------|------|
| 单击 | mouseDown + mouseUp（无移动） | 选中整组 |
| 拖拽 | mouseDown（已选中）+ mouseMove | 移动整组 |

### 3. 事件处理顺序

```
mouseDown → 检查是否已选中 → 决定是否开始拖拽
    ↓
mouseMove → 如果正在拖拽 → 更新预览位置
    ↓
mouseUp → 如果正在拖拽 → 完成移动
    ↓
click → 如果没有拖拽 → 选中座位
```

## 💡 使用技巧

### 技巧 1：快速移动座位组

```
1. 单击选中座位组（显示蓝色边框）
2. 按住座位拖拽到新位置
3. 释放鼠标完成移动
```

### 技巧 2：批量移动多组

```
1. 框选多个组
2. 按住任意选中座位
3. 拖拽移动所有组
```

### 技巧 3：避免意外移动

```
✅ 系统已防止单击时意外拖拽
✅ 只有明确选中后才能拖拽
✅ 不会因为手抖而移动座位
```

## 🔧 技术实现

### 拖拽检查逻辑

```typescript
handleSeatMouseDown(seatId) {
  // 关键检查：座位是否已选中？
  if (selectedSeatIds.has(seatId)) {
    // 已选中 → 允许拖拽
    setDraggingSeatIds(Array.from(selectedSeatIds));
    setDragStartWorld(worldPos);
  }
  // 未选中 → 不触发拖拽，由 onClick 处理选择
}
```

### 事件分离

```typescript
// mouseDown：只处理拖拽开始（已选中时）
onMouseDown={(e) => handleSeatMouseDown(e, seat.id)}

// click：处理选择逻辑
onClick={(e) => handleSeatClick(e, seat.id)}
```

## 📊 行为对比

| 场景 | v1.3 | v1.3.1 |
|------|------|--------|
| 单击未选中座位 | ❌ 立即开始拖拽 | ✅ 只选中，不拖拽 |
| 单击已选中座位 | ✅ 可以拖拽 | ✅ 可以拖拽 |
| 框选座位 | ✅ 扩展为整组 | ✅ 扩展为整组 |
| Ctrl+单击 | ✅ 切换整组 | ✅ 切换整组 |

## ✅ 最佳实践

### DO ✅

1. **先选择，后操作**
   ```
   单击选中 → 显示蓝色边框 → 再拖拽移动
   ```

2. **使用框选快速选择**
   ```
   框选大致区域 → 自动扩展为完整组
   ```

3. **使用 Ctrl+单击多选**
   ```
   单击第一组 → Ctrl+单击添加其他组
   ```

### DON'T ❌

1. **不要期望单击即拖拽**
   ```
   ❌ 单击未选中座位不会触发拖拽
   ✅ 需要先选中，再拖拽
   ```

2. **不要试图拖拽未选中座位**
   ```
   ❌ 系统会忽略拖拽操作
   ✅ 先单击选中，再拖拽
   ```

---

*创建日期: 2026-02-26*
*版本: v1.3.1*
