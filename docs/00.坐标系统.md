# åæ ‡ç³»ç»Ÿå®Œæ•´è®¾è®¡æ–¹æ¡ˆ

> æ•´åˆä¸¤å¥—åæ ‡ç³»ç†è®ºï¼Œæä¾›å®Œæ•´çš„å®ç°æŒ‡å—

---

## ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ä¸¥è°¨çš„åæ ‡ç³»ç»Ÿ

åœ¨ seats.io çš„ Designer ä¸­ï¼Œç”»å¸ƒä»**äº¤äº’ä½“éªŒ**ä¸Šçœ‹å‡ ä¹æ˜¯æ— é™çš„ï¼Œä½†ä»**æŠ€æœ¯å®ç°**ä¸Šçœ‹éœ€è¦ä¸¥æ ¼çš„åæ ‡ç®¡ç†ã€‚

### å¸¸è§é”™è¯¯

- æ··ç”¨ world å’Œ screen åæ ‡
- å­˜ screen åæ ‡åˆ°æ•°æ®
- æ‹–åŠ¨æ—¶ç›´æ¥æ”¹ world
- zoom åä¸é‡æ–°è®¡ç®— offset
- SVG transform é¡ºåºå†™å

---

## äºŒã€ä¸‰å¥—åæ ‡ç³»ï¼ˆå¿…é¡»å…¨éƒ¨å»ºç«‹ï¼‰

å¾ˆå¤šäººåªåš 2 å¥—ï¼Œè¿™æ˜¯é”™è¯¯æ ¹æºã€‚

### 1ï¸âƒ£ Screen Coordinateï¼ˆå±å¹•åæ ‡ï¼‰

æµè§ˆå™¨äº‹ä»¶ç»™ä½ çš„ï¼š

```javascript
e.clientX
e.clientY
```

**ç‰¹ç‚¹**ï¼š
- å•ä½ï¼špx
- ç›¸å¯¹äºæµè§ˆå™¨çª—å£
- ä¼šå—é¡µé¢æ»šåŠ¨å½±å“

âš ï¸ **ç»å¯¹ä¸è¦ç›´æ¥ç”¨å®ƒå­˜æ•°æ®**

---

### 2ï¸âƒ£ Viewport Coordinateï¼ˆè§†å£åæ ‡ï¼‰

SVG æˆ– Canvas å®¹å™¨å†…éƒ¨åæ ‡ã€‚

```javascript
const rect = container.getBoundingClientRect()
const viewportX = e.clientX - rect.left
const viewportY = e.clientY - rect.top
```

è¿™ä¸€æ­¥åªæ˜¯æŠŠæµè§ˆå™¨åæ ‡è½¬æ¢åˆ°ç”»å¸ƒå†…éƒ¨ã€‚

---

### 3ï¸âƒ£ World Coordinateï¼ˆä¸–ç•Œåæ ‡ï¼‰ã€æ ¸å¿ƒã€‘

æ‰€æœ‰æ•°æ®éƒ½åªç”¨ world åæ ‡ï¼š

- section
- seat
- selection
- snapping

**å­˜å‚¨ç»“æ„**ï¼š

```typescript
interface WorldObject {
  id: string
  type: 'section' | 'seat'
  x: number
  y: number
}
```

---

## ä¸‰ã€åæ ‡ç³»è®¾è®¡åŸç†

### ä¸ºä»€ä¹ˆé‡‡ç”¨å¤§åæ ‡ç³»è€ŒéçœŸæ— é™

**æŠ€æœ¯é™åˆ¶**ï¼š
- æµè§ˆå™¨æ•°å€¼æœ‰é™ï¼ˆfloat ç²¾åº¦ï¼‰
- SVG / Canvas æœ‰æœ€å¤§å°ºå¯¸é™åˆ¶

**å¤§åæ ‡ä¼šå¯¼è‡´**ï¼š
- ç²¾åº¦ä¸¢å¤±
- hit testing é”™ä¹±
- æ€§èƒ½é—®é¢˜

**æ¨èèŒƒå›´**ï¼š

```javascript
world = {
  minX: -100000,
  maxX: 100000,
  minY: -100000,
  maxY: 100000
}
```

> è¶³å¤Ÿå¤§ï¼ˆç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°è¾¹ç•Œï¼‰ï¼Œä½†æœ‰ç•Œå¯æ§ã€‚

---

## å››ã€æ ¸å¿ƒå…¬å¼ï¼ˆå¿…é¡»æŒæ¡ï¼‰

### world â†’ screen

```javascript
screenX = worldX * scale + offsetX
screenY = worldY * scale + offsetY
```

### screen â†’ world

```javascript
worldX = (screenX - offsetX) / scale
worldY = (screenY - offsetY) / scale
```

âš ï¸ **æ‰€æœ‰é¼ æ ‡äº‹ä»¶éƒ½å¿…é¡»åšè¿™ä¸€æ­¥è½¬æ¢**

---

## äº”ã€Viewport ç»“æ„

```typescript
interface Viewport {
  scale: number
  offsetX: number
  offsetY: number
}
```

**æ¨èåˆå§‹åŒ–**ï¼š

```javascript
scale = 1
offsetX = canvasWidth / 2
offsetY = canvasHeight / 2
```

è¿™æ · world(0,0) åœ¨ç”»å¸ƒä¸­å¿ƒã€‚

---

## å…­ã€å…³é”®äº¤äº’å®ç°

### 1. æ‹–åŠ¨ç”»å¸ƒï¼ˆPanï¼‰

**æœ¬è´¨**ï¼šåªæ”¹ offsetï¼Œä¸åŠ¨ world æ•°æ®

```javascript
offsetX += deltaX
offsetY += deltaY
```

---

### 2. ä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒçš„ç¼©æ”¾

**é”™è¯¯å†™æ³•**ï¼š

```javascript
scale *= 1.1  // âŒ è¿™æ ·ç¼©æ”¾ä¸­å¿ƒä¼šé£˜
```

**æ­£ç¡®æ–¹å¼**ï¼š

```javascript
// æ­¥éª¤ 1ï¼šè·å–é¼ æ ‡å½“å‰ world åæ ‡
const worldBefore = screenToWorld(mouseX, mouseY)

// æ­¥éª¤ 2ï¼šæ”¹å˜ scale
scale *= zoomFactor

// æ­¥éª¤ 3ï¼šé‡æ–°è®¡ç®— offsetï¼Œä¿è¯ç¼©æ”¾å‰åçš„ world ç‚¹ä¸ç§»åŠ¨
offsetX = mouseX - worldBefore.x * scale
offsetY = mouseY - worldBefore.y * scale
```

ğŸ‘‰ **è¿™æ˜¯æ— é™ç”»å¸ƒæ‰‹æ„Ÿçš„å…³é”®**

---

## ä¸ƒã€SVG æ¸²æŸ“ç»“æ„

### æ¨èå±‚çº§

```svg
<svg>
  <g id="viewport">
    <g id="background"/>
    <g id="sections"/>
    <g id="seats"/>
  </g>
</svg>
```

### Transform åº”ç”¨

```javascript
viewportGroup.setAttribute(
  'transform',
  `translate(${offsetX}, ${offsetY}) scale(${scale})`
)
```

âš ï¸ **é‡è¦**ï¼š
- æ°¸è¿œä¸è¦å•ç‹¬ç»™ seat è®¾ç½® scale
- æ‰€æœ‰ç¼©æ”¾ç»Ÿä¸€ç”± viewport æ§åˆ¶
- æ­£ç¡®é¡ºåºï¼štranslate â†’ scale

---

## å…«ã€seats.io ä¸ºä»€ä¹ˆå¯ä»¥çœ‹èµ·æ¥"æ— é™"

### åŸå› ä¸€ï¼šèƒŒæ™¯ SVG åªæ˜¯è§†è§‰å‚è€ƒå±‚

- è¢«å½“ä½œ background layer
- ä¸ä¼šç›´æ¥ä¿®æ”¹
- ä¹Ÿä¸å½±å“åæ ‡ç³»

**ç»“è®º**ï¼šç”»å¸ƒ â‰  SVG å¤§å°

---

### åŸå› äºŒï¼šæ‰€æœ‰å…ƒç´ éƒ½æ˜¯é€»è¾‘æ•°æ®

æ¯ä¸ª seat æœ¬è´¨æ˜¯ç»“æ„åŒ–æ•°æ®ï¼Œä¸ä¾èµ– SVG åæ ‡ç³»ç»Ÿã€‚

```javascript
{
  id,
  x,
  y,
  row,
  label,
  category
}
```

---

### åŸå› ä¸‰ï¼šé€šè¿‡ç¼©æ”¾ + å¹³ç§»åˆ¶é€ æ— é™ç©ºé—´é”™è§‰

åªè¦ scale ä¸çˆ†ã€translate ä¸æº¢å‡ºï¼Œç†è®ºä¸Šå¯ä»¥æ— é™æ‹–åŠ¨ã€‚

---

## ä¹ã€è¾¹ç•Œæ§åˆ¶

### ç¼©æ”¾é™åˆ¶

```javascript
minScale = 0.2
maxScale = 5
```

ä¸è¦å…è®¸ scale < 0.05ï¼Œå¦åˆ™ï¼š
- float ç²¾åº¦ä¸¢å¤±
- hit test é”™ä½
- é€‰ä¸­æ¡†é£˜

### æ‹–åŠ¨é™åˆ¶

é¿å… offset è¿‡å¤§æº¢å‡ºã€‚

---

## åã€Section å†…éƒ¨ç¼–è¾‘çš„åæ ‡å¤„ç†

**ç­”æ¡ˆ**ï¼šä¸è¦åˆ›å»ºæ–°åæ ‡ç³»

æ‰€æœ‰ section ä»åœ¨ world åæ ‡ã€‚è¿›å…¥ section åªæ˜¯ï¼š

```javascript
currentEditingSectionId = 'xxx'
```

**é”™è¯¯åšæ³•**ï¼š
- åˆ›å»ºæ–°çš„å±€éƒ¨åæ ‡ç³»
- åµŒå¥— transform
- æ‰¹é‡ç§»åŠ¨é”™ä½
- å¯¼å‡ºæ•°æ®å¤æ‚

---

## åä¸€ã€æ¶æ„æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Interaction (é¼ æ ‡äº‹ä»¶)   â”‚  â†’ å…ˆè½¬ viewportï¼Œå†è½¬ world
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Viewport (scale/offset)  â”‚  â†’ åªå­˜è¿™ä¸¤ä¸ªå€¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  World (æ‰€æœ‰ä¸šåŠ¡æ•°æ®)      â”‚  â†’ æ‰€æœ‰æ“ä½œåœ¨è¿™é‡Œå®Œæˆ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SVG (æ¸²æŸ“å±‚)             â”‚  â†’ åªåšå±•ç¤ºï¼Œä¸å­˜çŠ¶æ€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒåŸåˆ™

1. **ç”»å¸ƒæ˜¯å‡çš„ï¼Œworld åæ ‡æ˜¯çœŸçš„**
2. **SVG åªæ˜¯æ¸²æŸ“å·¥å…·ï¼Œä¸å‚ä¸æ•°æ®é€»è¾‘**
3. **æ‰€æœ‰æ“ä½œåœ¨ world åæ ‡ç³»å®Œæˆï¼Œé€šè¿‡ viewport è½¬æ¢åˆ°å±å¹•**
4. **ä¸è¦ç›´æ¥ä¿®æ”¹ SVGï¼Œç»´æŠ¤ç‹¬ç«‹çš„æ•°æ®å±‚**

### ä¸€å¥è¯æ€»ç»“

> seats.io çš„ç”»å¸ƒ = è¶…å¤§ä¸–ç•Œåæ ‡ç³» + è§†å£å˜æ¢æœºåˆ¶ + æƒ°æ€§æ¸²æŸ“

ä»ç”¨æˆ·æ„ŸçŸ¥ä¸Šæ˜¯æ— é™ï¼Œä»æŠ€æœ¯å®ç°ä¸Šæ˜¯æœ‰é™ä½†è¶³å¤Ÿå¤§ã€‚
