# 组选择功能说明

## 📋 概述

在座位绘制系统中，所有选择操作都以**绘制的组为单位**进行。这意味着无论您使用单击还是框选，系统都会智能地选中完整的座位组。

## 🎯 核心概念

### 什么是"组"？

**组（Group）** = 一次绘制操作创建的所有座位

```
示例：
拖拽绘制一排 10 个座位 → 形成 1 个组（包含 10 个座位）
再拖拽绘制一排 8 个座位 → 形成另 1 个组（包含 8 个座位）
```

### 为什么要以组为单位？

1. **符合用户意图**：用户绘制时是以"排"为单位思考的
2. **提高效率**：不需要精确框选整排座位
3. **避免误操作**：防止意外选中部分座位导致的错误操作
4. **保持完整性**：确保批量操作不会破坏座位排列

## 🔍 选择行为详解

### 1. 单击选择

**行为**：单击任意座位 → 选中整组

```
场景：
1. 绘制一排 10 个座位
2. 单击第 5 个座位
3. ✅ 全部 10 个座位被选中（显示蓝色边框）
```

**技术实现**：
```typescript
// 单击座位
handleSeatClick(seatId) {
  // 提取组 ID
  const groupId = getGroupId(seatId);
  
  // 获取组内所有座位
  const groupSeats = getGroupSeatIds(groupId);
  
  // 选中整组
  onSelectSeats(groupSeats);
}
```

### 2. 框选选择（智能扩展）

**行为**：框选部分座位 → 自动扩展为完整的组

```
场景 1：框选单个组的一部分
1. 绘制一排 10 个座位
2. 框选只覆盖前 3 个座位
3. ✅ 自动扩展为全部 10 个座位

场景 2：框选多个组的一部分
1. 绘制 3 排座位（3 个组）
2. 框选覆盖第 1 排的后半部分 + 第 2 排的前半部分
3. ✅ 自动选中完整的第 1 排和第 2 排
```

**技术实现**：
```typescript
// 框选完成
handleBoxSelection(seatsInBox) {
  // 1. 找到框内的座位
  const seatsInBox = seats.filter(isInBox);
  
  // 2. 提取所有涉及的组 ID
  const groupIds = seatsInBox.map(getGroupId);
  
  // 3. 获取所有组的完整座位
  const allGroupSeats = groupIds.flatMap(getGroupSeatIds);
  
  // 4. 选中所有完整的组
  onSelectSeats(allGroupSeats);
}
```

### 3. Ctrl+单击（组切换）

**行为**：Ctrl+单击座位 → 切换整组的选中状态

```
场景：多组选择
1. 单击第 1 排 → 选中第 1 组
2. Ctrl+单击第 2 排 → 添加第 2 组（现在选中 2 组）
3. Ctrl+单击第 3 排 → 添加第 3 组（现在选中 3 组）
4. Ctrl+单击第 1 排 → 取消第 1 组（现在选中 2、3 组）
```

**技术实现**：
```typescript
// Ctrl+单击
handleCtrlClick(seatId) {
  const groupId = getGroupId(seatId);
  const groupSeats = getGroupSeatIds(groupId);
  
  // 检查组是否已选中
  const isGroupSelected = groupSeats.some(id => selectedIds.has(id));
  
  if (isGroupSelected) {
    // 取消选中整组
    groupSeats.forEach(id => selectedIds.delete(id));
  } else {
    // 选中整组
    groupSeats.forEach(id => selectedIds.add(id));
  }
}
```

## 💡 实用技巧

### 技巧 1：快速选中多排

**不推荐**：逐个单击每一排
```
❌ 单击第 1 排 → 单击第 2 排 → 单击第 3 排
   （需要精确点击 3 次）
```

**推荐**：框选部分区域
```
✅ 框选覆盖 3 排的任意部分
   （系统自动扩展为完整的 3 排）
```

### 技巧 2：选择不连续的组

```
1. 单击第 1 排 → 选中第 1 组
2. Ctrl+单击第 3 排 → 添加第 3 组
3. Ctrl+单击第 5 排 → 添加第 5 组
4. ✅ 现在选中了第 1、3、5 排
```

### 技巧 3：批量操作

```
1. 框选前 5 排（自动扩展为完整的组）
2. 右侧面板修改类型为 "VIP"
3. ✅ 所有选中的完整排都变为 VIP
```

### 技巧 4：取消部分选择

```
1. 框选选中 5 排座位
2. Ctrl+单击第 2 排 → 取消第 2 组
3. Ctrl+单击第 4 排 → 取消第 4 组
4. ✅ 现在只选中第 1、3、5 排
```

## 🎨 视觉反馈

### 选中状态显示

- **蓝色边框**：选中的座位
- **完整高亮**：整组座位都显示蓝色边框
- **半透明**：拖拽移动中的座位

### 框选预览

- **蓝色虚线框**：框选区域
- **实时扩展**：框选完成后立即看到扩展效果

## 🔧 技术细节

### 组 ID 格式

```typescript
// 座位 ID 格式
seat-group-{timestamp}-{index}

// 示例
seat-group-1709123456789-0  // 第 1 个座位
seat-group-1709123456789-1  // 第 2 个座位
seat-group-1709123456789-2  // 第 3 个座位
```

### 组识别算法

```typescript
// 1. 从座位 ID 提取组 ID
const groupMatch = seatId.match(/^seat-(group-\d+)-\d+$/);
const groupId = groupMatch ? groupMatch[1] : null;

// 2. 查找组内所有座位
const groupSeats = seats.filter(s => s.id.includes(groupId));

// 3. 扩展选择
const expandToGroups = (seatIds) => {
  const groupIds = new Set();
  
  // 收集所有组 ID
  seatIds.forEach(id => {
    const gid = getGroupId(id);
    if (gid) groupIds.add(gid);
  });
  
  // 获取所有组的完整座位
  return Array.from(groupIds).flatMap(getGroupSeatIds);
};
```

## 📊 行为矩阵

| 操作 | 输入 | 输出 | 说明 |
|------|------|------|------|
| 单击 | 点击 1 个座位 | 选中整组 | 自动扩展 |
| 框选 | 框选部分座位 | 选中所有涉及的完整组 | 智能扩展 |
| Ctrl+单击 | Ctrl+点击 1 个座位 | 切换整组状态 | 添加/移除组 |
| 框选（多组） | 框选跨越多组 | 选中所有完整组 | 批量扩展 |

## ✅ 最佳实践

### DO ✅

1. **使用框选快速选择多组**
   ```
   框选大致区域 → 系统自动扩展为完整组
   ```

2. **使用 Ctrl+单击精确控制**
   ```
   单击选中基础组 → Ctrl+单击添加/移除其他组
   ```

3. **信任自动扩展**
   ```
   不需要精确框选，部分覆盖即可
   ```

### DON'T ❌

1. **不要试图精确框选整组**
   ```
   ❌ 费时费力，系统会自动扩展
   ```

2. **不要期望选中部分座位**
   ```
   ❌ 系统设计为整组操作，无法选中部分
   ```

## 🐛 常见问题

### Q: 为什么框选只选到一个座位，却选中了整排？
**A:** 这是设计行为。系统自动扩展为完整的组，确保操作的完整性。

### Q: 如何只选中单个座位？
**A:** 当前版本不支持单个座位选择，所有操作都以组为单位。如果需要单独编辑某个座位，可以在右侧属性面板中修改。

### Q: 框选时如何知道会选中哪些组？
**A:** 框选完成后，所有涉及的完整组会立即显示蓝色边框。

### Q: Ctrl+单击和普通单击有什么区别？
**A:** 
- 普通单击：替换当前选择
- Ctrl+单击：切换组的选中状态（添加或移除）

---

*创建日期: 2026-02-26*
*版本: v1.3.0*
